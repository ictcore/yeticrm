
jQuery.Class("Vtiger_FileUpload_Js",{},{formElement:false,save:function(b){var a=jQuery.Deferred();var c=new FormData(b[0]);var d={url:"file.php",type:"POST",data:c,processData:false,contentType:false};AppConnector.request(d).then(function(e){a.resolve(e)},function(f,e){a.reject(f,e)});return a.promise()},getForm:function(){if(this.formElement==false){this.formElement=jQuery("form#fileUploadForm")}return this.formElement},updateForm:function(d){var a=$("#"+app.getModuleName()+"_editView_fieldName_"+d.result.field);var c=[];$.each(d.result.attach,function(e,g){c.push(g.id);var f=g.name+'&nbsp;<span class="btn btn-danger btn-xs multiImageDelete glyphicon glyphicon-trash" data-id="'+g.id+'"></span>';$('<div class="multiImageContenDiv row col-xs-12 marginTop2">').html(f).appendTo("#fileResult"+d.result.field)});var b=c.concat(JSON.parse("["+a.val().replace(/(^,)|(,$)/g,"")+"]"));a.val(","+b.toString()+",")},registerUploadFiles:function(){var e=this;var b=jQuery("#modalFileUpload");var f=b.find("input#fileupload");var g=parseInt(b.find(".maxUploadFileSize").val());var a=b.find('button[type="submit"]');var c=b.find(".fileContainer");var d=b.find(".uploadFileContainer");f.change(function(){d.find(".fileItem").remove();var j=f[0].files;for(var h=0;h<j.length;h++){if(j[h].size>g){alert(app.vtranslate("JS_FILE_EXCEEDS_MAX_UPLOAD_SIZE"));f.val("");a.prop("disabled",true);break}d.append(c.html());d.find('[name="nameFile[]"]:last').val(j[h].name)}if(j.length){a.prop("disabled",false)}else{a.prop("disabled",true)}});this.getForm().on("submit",function(j){var h=jQuery(j.currentTarget);var i=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});app.hideModalWindow();e.save(h).then(function(k){e.updateForm(k);i.progressIndicator({mode:"hide"})});j.preventDefault()});f.trigger("click")},registerEvents:function(){this.registerUploadFiles()}});jQuery(document).ready(function(b){var a=new Vtiger_FileUpload_Js();a.registerEvents()});