jQuery.Class("Vtiger_TreePopup_Js",{getInstance:function(){var c=app.getModuleName();var d=jQuery("#popUpClassName").val();if(typeof d!="undefined"){var b=d}else{var b=c+"_TreePopup_Js"}var e=Vtiger_TreePopup_Js;if(typeof window[b]!="undefined"){var a=new window[b]()}else{var a=new e()}return a}},{eventName:"",popupPageContentsContainer:false,jstreeInstance:false,multiple:false,container:false,setEventName:function(a){this.eventName=a},setMultiple:function(a){this.multiple=a==1?true:false},setContainer:function(a){this.container=a},getEventName:function(){return this.eventName},getPopupPageContainer:function(){if(this.popupPageContentsContainer==false){this.popupPageContentsContainer=jQuery("#treePopupContainer")}return this.popupPageContentsContainer},done:function(a,d,b){if(typeof d=="undefined"||d.length<=0){d="postSelection"}if(typeof b=="undefined"){b=self}b.close();var c=JSON.stringify(a);c=c.replace(/\$\$/g,"$ $");jQuery.triggerParentEvent(d,c)},generateTree:function(){var c=this;if(c.jstreeInstance==false){var b=$("#treePopupValues").val();var d=JSON.parse(b);c.jstreeInstance=$("#treePopupContents");var a=[];if(this.multiple){a.push("category");a.push("checkbox")}c.jstreeInstance.jstree({core:{data:d,themes:{name:"proton",responsive:true}},plugins:a});c.jstreeInstance.on("select_node.jstree",function(e,f){c.registerSelect(f.node)})}return this.jstreeInstance},registerSelect:function(c){if(!this.multiple){var b=this;var a={id:c.id,name:c.text};b.done(a,b.getEventName())}},registerSaveRecords:function(){var a=this;if(this.multiple){this.container.find('[name="saveButton"]').on("click",function(f){var d=[];var b=[];$.each(a.jstreeInstance.jstree("getCategory",true),function(e,g){d.push(g.id);b.push(g.text)});d=d.join();b=b.join(", ");var c={id:d,name:b};a.done(c,a.getEventName())})}},registerEvents:function(){this.setMultiple($("#isMultiple").val());this.setContainer($("#treePopupContainer"));this.generateTree();this.registerSaveRecords()}});jQuery(document).ready(function(){var b=Vtiger_TreePopup_Js.getInstance();var a=jQuery(".triggerEventName").val();var c=(jQuery(document).height())+"px";jQuery("#popupPageContainer").css("height",c);b.setEventName(a);b.registerEvents();Vtiger_Helper_Js.showHorizontalTopScrollBar()});