
Vtiger_AdvanceFilter_Js("Vtiger_AdvanceFilterEx_Js",{},{validationSupportedFieldConditionMap:{email:["e","n"],date:["is"],datetime:["is"]},allConditionValidationNeededFieldList:["double","integer"],comparatorsWithNoValueBoxMap:["has changed","is empty","is not empty","is added"],init:function(a){if(typeof a=="undefined"){a=jQuery("#advanceFilterContainer")}if(a.is("#advanceFilterContainer")){this.setFilterContainer(a)}else{this.setFilterContainer(jQuery("#advanceFilterContainer",a))}this.initialize()},getFieldSpecificType:function(c){var a=c.data("fieldinfo");var b=a.type;return b},getModuleName:function(){return"AdvanceFilterEx"},addNewCondition:function(d){var c=jQuery(".basic",d);var a=c.find(".conditionRow").clone(true,true);jQuery("select",a).addClass("chzn-select");var b=jQuery(".conditionList",d);b.append(a);app.changeSelectElementView(a);a.find('[name="columnname"]').find("optgroup:first option:first").attr("selected","selected").trigger("chosen:updated").trigger("change");return this},loadConditions:function(b){var m=b.closest("div.conditionRow");var d=m.find('select[name="comparator"]');var a=d.val();var g=b.find("option:selected");var c=g.val();var h=c.match(/\((\w+)\) (\w+)/);var e=this.getFieldSpecificType(g);var f=this.getConditionListFromType(e);if(typeof f=="undefined"){f={};f.none="None"}var l="";for(var k in f){if(f.hasOwnProperty(k)){var j=f[k];var i=this.getConditionLabel(j);if(h!=null){if(j!="has changed"){l+='<option value="'+j+'"';if(j==a){l+=' selected="selected" '}l+=">"+i+"</option>"}}else{l+='<option value="'+j+'"';if(j==a){l+=' selected="selected" '}l+=">"+i+"</option>"}}}d.empty().html(l).trigger("chosen:updated");return d},getValues:function(){var d=this;var e=this.getFilterContainer();var b=new Array("columnname","comparator","value","valuetype","column_condition");var a={};var c=0;var f=jQuery(".conditionGroup",e);f.each(function(h,k){var i=jQuery(k);var j=jQuery(".conditionList .conditionRow",i);if(j.length<=0){return true}var g={};j.each(function(q,t){var p=jQuery(t);var l=jQuery('[name="columnname"]',p);var n=jQuery('[data-value="value"]',p);if(d.isEmptyFieldSelected(l)){return true}var o=l.find("option:selected").data("fieldinfo");var r=o.type;var A={};if($.inArray(r,["picklist","multipicklist","multiReferenceValue"])>-1){for(var z in b){var v=b[z];if(v=="value"&&n.is("input")){var y=n.val();var u=n.data("picklistvalues");var x=y.split(",");var s=[];for(q=0;q<x.length;q++){if(typeof u[x[q]]!="undefined"){s.push(u[x[q]])}else{s.push(x[q])}}var m=s.join(",");A[v]=m}else{if(v=="value"&&n.is("select")&&r=="picklist"){A[v]=n.val()}else{if(v=="value"&&n.is("select")&&$.inArray(r,["multipicklist","multiReferenceValue"])>-1){var w=n.val();if(w==null){A[v]=w}else{A[v]=w.join(",")}}else{A[v]=jQuery('[name="'+v+'"]',p).val()}}}}}else{for(var z in b){var v=b[z];if(v=="value"){A[v]=n.val()}else{A[v]=jQuery('[name="'+v+'"]',p).val()}}}if(jQuery('[name="valuetype"]',p).val()=="false"||(jQuery('[name="valuetype"]',p).length==0)){A.valuetype="rawtext"}if(h=="0"){A.groupid="0"}else{A.groupid="1"}if(p.is(":last-child")){A.column_condition=""}g[c]=A;c++});if(!jQuery.isEmptyObject(g)){a[h+1]={};a[h+1]["columns"]=g}if(i.find("div.groupCondition").length>0&&!jQuery.isEmptyObject(a[h+1])){a[h+1]["condition"]=f.find('div.groupCondition [name="condition"]').val()}});return a},getFieldSpecificUi:function(a){var c=a.find("option:selected");var b=c.data("fieldinfo");if(jQuery.inArray(b.comparatorElementVal,this.comparatorsWithNoValueBoxMap)!=-1){return jQuery("")}else{return this._super(a)}},getPopUp:function(a){var b=this;if(typeof a=="undefined"){a=b.getFilterContainer()}a.on("click",".getPopupUi",function(j){var g=jQuery(j.currentTarget);var d=g.val();var q=g.closest(".fieldUiHolder");var h=q.find('[name="valuetype"]').val();if(h==""){h="rawtext"}var m=g.closest(".conditionsContainer");var c=g.closest(".conditionRow");var l=m.find(".popupUi").clone(true,true).removeClass("popupUi").addClass("clonedPopupUi");l.find("select").addClass("chzn-select");l.find(".fieldValue").val(d);if(g.hasClass("date")){l.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");var p=g.data("date-format");if(h=="rawtext"){var o=g.val()}else{o=""}var k='<input type="text" class="dateField fieldValue col-md-4" value="'+o+'" data-date-format="'+p+'" data-input="true" >';l.find(".fieldValueContainer").prepend(k)}else{if(g.hasClass("time")){l.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");if(h=="rawtext"){var o=g.val()}else{o=""}var n='<input type="text" class="timepicker-default fieldValue col-md-4 form-control" value="'+o+'" data-input="true" >';l.find(".fieldValueContainer").prepend(n)}else{if(g.hasClass("boolean")){l.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");if(h=="rawtext"){var o=g.val()}else{o=""}var i='<input type="checkbox" class="fieldValue col-md-4" value="'+o+'" data-input="true" >';l.find(".fieldValueContainer").prepend(i);var d=l.find(".fieldValueContainer input").val();if(o=="true:boolean"||o==""){l.find(".fieldValueContainer input").attr("checked","checked")}else{l.find(".fieldValueContainer input").removeAttr("checked")}}}}var f=function(r){r.find(".clonedPopupUi").removeClass("hide");var s=c.find('[name="modulename"]');if(s.length>0){var e=s.val();r.find(".useFieldElement").addClass("hide");r.find('[name="'+e+'"]').removeClass("hide")}app.changeSelectElementView(r);app.registerEventForDatePickerFields(r);app.registerEventForTimeFields(r);b.postShowModalAction(r,h);b.registerChangeFieldEvent(r);b.registerSelectOptionEvent(r);b.registerPopUpSaveEvent(r,q);b.registerRemoveModalEvent(r);r.find(".fieldValue").filter(":visible").trigger("focus");r.find('[data-close-modal="modal"]').off("click").on("click",function(){jQuery(this).closest(".modal").removeClass("in").css("display","none")})};m.find(".clonedPopUp").html(l);jQuery(".clonedPopupUi").on("shown.bs.modal",function(){if(typeof f=="function"){f(jQuery(".clonedPopupUi",m))}});jQuery(".clonedPopUp",m).find(".clonedPopupUi").modal()})},postShowModalAction:function(b,c){if(c=="fieldname"){jQuery(".useFieldContainer",b).removeClass("hide");jQuery(".textType",b).val(c).trigger("chosen:updated")}else{if(c=="expression"){jQuery(".useFieldContainer",b).removeClass("hide");jQuery(".useFunctionContainer",b).removeClass("hide");jQuery(".textType",b).val(c).trigger("chosen:updated")}}jQuery("#"+c+"_help",b).removeClass("hide");var a=jQuery(".textType",b).find("option:selected").data("ui");jQuery(".fieldValue",b).hide();jQuery("[data-"+a+"]",b).show()},registerChangeFieldEvent:function(a){jQuery(".textType",a).on("change",function(f){var g=jQuery(f.currentTarget).val();var c=jQuery(".useFieldContainer",a);var d=jQuery(".useFunctionContainer",a);var b=jQuery(f.currentTarget).find("option:selected").data("ui");jQuery(".fieldValue",a).hide();jQuery("[data-"+b+"]",a).show();if(g=="fieldname"){c.removeClass("hide");d.addClass("hide")}else{if(g=="expression"){c.removeClass("hide");d.removeClass("hide")}else{c.addClass("hide");d.addClass("hide")}}jQuery(".helpmessagebox",a).addClass("hide");jQuery("#"+g+"_help",a).removeClass("hide");a.find(".fieldValue").val("")})},registerSelectOptionEvent:function(a){jQuery(".useField,.useFunction",a).on("change",function(f){var c=jQuery(f.currentTarget);var d=c.val();var b=a.find(".fieldValue").filter(":visible").val();if(c.hasClass("useField")){if(b!=""){var g=b+" "+d}else{g=d}}else{g=b+d}a.find(".fieldValue").val(g);c.val("").trigger("chosen:updated")})},registerPopUpSaveEvent:function(b,a){jQuery('[name="saveButton"]',b).on("click",function(g){var h=jQuery(".textType",b).val();a.find('[name="valuetype"]').val(h);var d=a.find(".getPopupUi");if(h!="rawtext"){d.removeAttr("data-validation-engine");d.removeClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]")}else{d.addClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]");d.attr("data-validation-engine","validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]")}var c=b.find(".fieldValue").filter(":visible").attr("type");var f=b.find(".fieldValue").filter(":visible").val();if(c=="checkbox"){if(b.find(".fieldValue").filter(":visible").is(":checked")){f="true:boolean"}else{f="false:boolean"}}d.val(f);b.modal("hide");d.validationEngine("hide")})},registerRemoveModalEvent:function(a){a.on("click",".closeModal",function(b){a.modal("hide")})},registerEvents:function(){this._super();this.getPopUp()}});Vtiger_Field_Js("AdvanceFilterEx_Field_Js",{},{getUiTypeSpecificHtml:function(){var a=this.getUiTypeModel();return a.getUi()},getModuleName:function(){var a=app.getModuleName();return a},getUi:function(){var a='<input type="text" class="getPopupUi form-control" name="'+this.getName()+'"  /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';a=jQuery(a);a.filter(".getPopupUi").val(app.htmlDecode(this.getValue()));return this.addValidationToElement(a)}});Vtiger_Date_Field_Js("AdvanceFilterEx_Date_Field_Js",{},{getDateFormat:function(){return this.get("date-format")},getUi:function(){var b=this.get("comparatorElementVal");var f=this.get("dateSpecificConditions");if(b.length>0){if(b=="between"||b=="custom"){var e='<div class="date"><input class="dateRangeField" data-calendar-type="range" name="'+this.getName()+'" data-date-format="'+this.getDateFormat()+'" type="text" ReadOnly="true" value="'+this.getValue()+'"></div>';var d=jQuery(e);return this.addValidationToElement(d)}else{if(this._specialDateComparator(b)){var e='<input name="'+this.getName()+'" type="text" value="'+this.getValue()+'" data-validation-engine="validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]" data-validator="[{"name":"PositiveNumber"}]">\n							<input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';return jQuery(e)}else{if(b in f){var c=f[b]["startdate"];var a=f[b]["enddate"];var e='<input name="'+this.getName()+'"  type="text" ReadOnly="true" value="'+c+","+a+'">';return jQuery(e)}else{if(b=="is today"){}else{return this._super()}}}}}else{var e='<input type="text" class="getPopupUi date form-control" name="'+this.getName()+'"  data-date-format="'+this.getDateFormat()+'"  value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';var d=jQuery(e);return this.addValidationToElement(d)}},_specialDateComparator:function(a){var c=["less than days ago","more than days ago","in less than","in more than","days ago","days later"];for(var b in c){if(a==c[b]){return true}}return false}});Vtiger_Date_Field_Js("AdvanceFilterEx_Datetime_Field_Js",{},{getDateFormat:function(){return this.get("date-format")},getUi:function(){var a=this.get("comparatorElementVal");if(this._specialDateTimeComparator(a)){var c='<input name="'+this.getName()+'" type="text" value="'+this.getValue()+'" data-validator="[{name:PositiveNumber}]"><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';var b=jQuery(c)}else{var c='<input type="text" class="getPopupUi date form-control" name="'+this.getName()+'"  data-date-format="'+this.getDateFormat()+'"  value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';var b=jQuery(c)}return b},_specialDateTimeComparator:function(a){var c=["less than hours before","less than hours later","more than hours later","more than hours before"];for(var b in c){if(a==c[b]){return true}}return false}});Vtiger_Currency_Field_Js("AdvanceFilterEx_Currency_Field_Js",{},{getUi:function(){var b='<input type="text" class="getPopupUi marginLeftZero form-control" name="'+this.getName()+'" value="'+this.getValue()+'"  /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';var a=jQuery(b);return this.addValidationToElement(a)}});Vtiger_Time_Field_Js("AdvanceFilterEx_Time_Field_Js",{},{getUi:function(){var b='<input type="text" class="getPopupUi time form-control" name="'+this.getName()+'"  value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';var a=jQuery(b);return this.addValidationToElement(a)}});Vtiger_Field_Js("Vtiger_Percentage_Field_Js",{},{getUi:function(){var b='<input type="text" class="getPopupUi form-control" name="'+this.getName()+'" value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';var a=jQuery(b);return this.addValidationToElement(a)}});Vtiger_Field_Js("Vtiger_Text_Field_Js",{},{getUi:function(){var b='<input type="text" class="getPopupUi form-control" name="'+this.getName()+'" value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';var a=jQuery(b);return this.addValidationToElement(a)}});Vtiger_Field_Js("Vtiger_Boolean_Field_Js",{},{getUi:function(){var b='<input type="text" class="getPopupUi form-control boolean" name="'+this.getName()+'" value="'+this.getValue()+'" /><input type="hidden" name="valuetype" value="'+this.get("workflow_valuetype")+'" />';var a=jQuery(b);return this.addValidationToElement(a)}});Vtiger_Owner_Field_Js("AdvanceFilterEx_Owner_Field_Js",{},{getUi:function(){var a='<select class="chzn-select" name="'+this.getName()+'">';var f=this.getPickListValues();var c=this.getValue();for(var e in f){a+='<optgroup label="'+e+'">';var g=f[e];for(var b in g){a+='<option value="'+b+'" ';if(b==c){a+=" selected "}a+=">"+g[b]+"</option>"}a+="</optgroup>"}a+="</select>";var d=jQuery(a);this.addValidationToElement(d);return d}});Vtiger_Picklist_Field_Js("AdvanceFilterEx_Picklist_Field_Js",{},{});