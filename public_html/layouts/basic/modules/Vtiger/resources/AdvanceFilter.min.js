
jQuery.Class("Vtiger_AdvanceFilter_Js",{getInstance:function(b){var c=app.getModuleName();var g=c+"_AdvanceFilterEx_Js";var f=c+"_AdvanceFilter_Js";var e="Vtiger_AdvanceFilterEx_Js";var d="Vtiger_AdvanceFilter_Js";var a;if(typeof window[g]!="undefined"){a=new window[g](b)}else{if(typeof window[f]!="undefined"){a=new window[f](b)}else{if(typeof window[e]!="undefined"){a=new window[e](b)}else{a=new window[d](b)}}}return a}},{filterContainer:false,fieldTypeConditionMapping:false,conditonOperatorLabelMapping:false,dateConditionInfo:false,fieldModelInstance:false,validationSupportedFieldConditionMap:{email:["e","n"]},allConditionValidationNeededFieldList:["double","integer","currency"],validationForControlsRegistered:false,init:function(a){if(typeof a=="undefined"){a=jQuery(".filterContainer")}if(a.is(".filterContainer")){this.setFilterContainer(a)}else{this.setFilterContainer(jQuery(".filterContainer",a))}this.initialize()},getModuleName:function(){return"AdvanceFilter"},initialize:function(){this.registerEvents();this.initializeOperationMappingDetails();this.loadFieldSpecificUiForAll()},initializeOperationMappingDetails:function(){var a=this.getFilterContainer();this.fieldTypeConditionMapping=jQuery('input[name="advanceFilterOpsByFieldType"]',a).data("value");this.conditonOperatorLabelMapping=jQuery('input[name="advanceFilterOptions"]',a).data("value");this.dateConditionInfo=jQuery('[name="date_filters"]').data("value");return this},getFilterContainer:function(){return this.filterContainer},setFilterContainer:function(a){this.filterContainer=a;return this},getDateSpecificConditionInfo:function(){return this.dateConditionInfo},getConditionListFromType:function(a){var b=this.fieldTypeConditionMapping[a];if(a=="D"||a=="DT"){b=b.concat(this.getDateConditions(a))}return b},getDateConditions:function(a){if(a!="D"&&a!="DT"){return[]}var c=this.getFilterContainer();var b=this.getDateSpecificConditionInfo();return Object.keys(b)},getConditionLabel:function(a){if(a in this.conditonOperatorLabelMapping){return this.conditonOperatorLabelMapping[a]}if(a in this.getDateSpecificConditionInfo()){return this.getDateSpecificConditionInfo()[a]["label"]}return a},isEmptyFieldSelected:function(a){var b=a.find("option:selected");if(b.val()=="none"){return true}return false},getAddConditionElement:function(){var a=this.getFilterContainer();return jQuery(".addCondition button",a)},addNewCondition:function(d){var c=jQuery(".basic",d);var a=c.find(".conditionRow").clone(true,true);jQuery("select",a).addClass("chzn-select");var b=jQuery(".conditionList",d);b.append(a);app.changeSelectElementView(a);return this},addConditionHandler:function(c){var b=jQuery(c.currentTarget);var a=b.closest("div.conditionGroup");this.addNewCondition(a)},getFieldSpecificType:function(c){var a=c.data("fieldinfo");var b=a.type;if(b=="reference"){return"V"}return c.data("fieldtype")},loadConditions:function(c){var m=c.closest("div.conditionRow");var d=m.find('select[name="comparator"]');var b=d.val();var g=c.find("option:selected");var e=this.getFieldSpecificType(g);var f=this.getConditionListFromType(e);var k=g.data("field-name");var a=g.data("fieldinfo");if(typeof f=="undefined"){f={};f.none="None"}var l="";for(var j in f){if(jQuery.inArray(a.type,["rangeTime","image"])!=-1&&jQuery.inArray(f[j],["y","ny"])==-1){continue}if(jQuery.inArray(a.type,["userCreator","owner","picklist","modules","tree","inventoryLimit","languages","currencyList","fileLocationType"])!=-1&&jQuery.inArray(f[j],["s","ew","c","k"])!=-1){continue}if(f[j]==="om"&&jQuery.inArray(a.type,["owner","sharedOwner","userCreator"])==-1){continue}if(jQuery.inArray(f[j],["wr","nwr"])!=-1&&jQuery.inArray(a.type,["owner"])==-1){continue}if(jQuery.inArray(f[j],["s","ew"])!=-1&&jQuery.inArray(a.type,["taxes","multipicklist","categoryMultipicklist","sharedOwner"])!=-1){continue}if(jQuery.inArray(f[j],["bw","m","h"])!=-1&&jQuery.inArray(a.type,["time"])!=-1){continue}if(f.hasOwnProperty(j)){var i=f[j];var h=this.getConditionLabel(i);l+='<option value="'+i+'"';if(i==b){l+=' selected="selected" '}l+=">"+h+"</option>"}}d.empty().html(l).trigger("chosen:updated");return d},getFieldSpecificUi:function(a){var f=a.find("option:selected");var b=this.fieldModelInstance;if(b.getType().toLowerCase()=="boolean"){var e=a.closest(".conditionRow");var d=e.find('[data-value="value"]').val();var c='<select class="chzn-select" name="'+b.getName()+'">';c+='<option value="0"';if(d=="0"){c+=' selected="selected" '}c+=">"+app.vtranslate("JS_IS_DISABLED")+"</option>";c+='<option value="1"';if(d=="1"){c+=' selected="selected" '}c+=">"+app.vtranslate("JS_IS_ENABLED")+"</option>";c+="</select>";return jQuery(c)}else{return jQuery(b.getUiTypeSpecificHtml())}},loadFieldSpecificUi:function(b){var e=b.find("option:selected");var m=b.closest("div.conditionRow");var l=m.find(".fieldUiHolder");var d=m.find('select[name="comparator"]');var a=e.data("fieldinfo");var g="string";if(typeof a!="undefined"){g=a.type}var f=a.comparatorElementVal=d.val();if(g=="date"||g=="datetime"){a.dateSpecificConditions=this.getDateSpecificConditionInfo()}var c=this.getModuleName();var i=Vtiger_Field_Js.getInstance(a,c);this.fieldModelInstance=i;var h=this.getFieldSpecificUi(b);var k=i.getName();if($.inArray(i.getType(),["multipicklist","sharedOwner","multiReferenceValue","taxes","categoryMultipicklist"])>-1){k=k+"[]"}else{if(($.inArray(i.getType(),["userCreator","picklist","owner","languages","modules","inventoryLimit","currencyList","fileLocationType"])>-1)&&h.is("select")&&(f=="e"||f=="n")){k=k+"[]"}}if(h.find(".input-group-addon").length>0){h.find(".input-group").addClass("row");h.find(".input-group").addClass("row");h.find('input[type="text"]').css("width","100%");h.find('input[type="text"]').addClass("form-control")}else{h.filter('[name="'+k+'"]').addClass("form-control");h.find('[name="'+k+'"]').addClass("row form")}h.filter('[name="'+k+'"]').attr("data-value","value").removeAttr("data-validation-engine");h.find('[name="'+k+'"]').attr("data-value","value").removeAttr("data-validation-engine");if(i.getType()=="currency"){h.filter('[name="'+k+'"]').attr("data-decimal-separator",a.decimal_separator).attr("data-group-separator",a.group_separator);h.find('[name="'+k+'"]').attr("data-decimal-separator",a.decimal_separator).attr("data-group-separator",a.group_separator)}l.html(h);if(h.is("select")){if(h.hasClass("chzn-select")){app.changeSelectElementView(h)}else{app.showSelect2ElementView(h)}}else{if(h.has("input.dateField").length>0){app.registerEventForDatePickerFields(h)}else{if(h.has("input.dateRangeField").length>0){app.registerDateRangePickerFields(h,{ranges:false})}else{if(h.has("input.timepicker-default").length>0){app.registerEventForTimeFields(h)}}}}this.addValidationToFieldIfNeeded(b);var j=["y","today","tomorrow","yesterday","ny","om","wr","nwr"];if(j.indexOf(d.val())!=-1){l.hide()}else{l.show()}return this},loadFieldSpecificUiForAll:function(){var b=jQuery(".conditionList");var a=jQuery('select[name="columnname"]',b);jQuery.each(a,function(d,e){var c=jQuery(e);if(c.val()!="none"){c.trigger("change",{_intialize:true})}});return this},addValidationToFieldIfNeeded:function(e){var c=e.find("option:selected");var d=e.closest("div.conditionRow");var a=d.find('[data-value="value"]');var b=c.attr("data-validator");if(this.isFieldSupportsValidation(e)){a.addClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]").attr("data-validation-engine","validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]").attr("data-fieldinfo",JSON.stringify(c.data("fieldinfo")));if(typeof b!="undefined"){a.attr("data-validator",b)}}else{a.removeClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]").removeAttr("data-validation-engine").removeAttr("data-fieldinfo")}return this},isFieldSupportsValidation:function(c){var f=c.find("option:selected");var b=this.fieldModelInstance;var e=b.getType();if(jQuery.inArray(e,this.allConditionValidationNeededFieldList)>=0){return true}var g=c.closest("div.conditionRow");var a=g.find('select[name="comparator"]');var d=a.find("option:selected");var h=a.val();if(e in this.validationSupportedFieldConditionMap){if(jQuery.inArray(h,this.validationSupportedFieldConditionMap[e])>=0){return true}}return false},getValues:function(){var d=this;var e=this.getFilterContainer();var b=new Array("columnname","comparator","value","column_condition");var a={};var c=0;var f=jQuery(".conditionGroup",e);f.each(function(g,j){var h=jQuery(j);a[g+1]={};var i=jQuery(".conditionList .conditionRow",h);a[g+1]["columns"]={};i.each(function(x,y){var n=jQuery(y);var k=jQuery('[name="columnname"]',n);var z=jQuery('[data-value="value"]',n);if(d.isEmptyFieldSelected(k)){return true}var o=k.find("option:selected").data("fieldinfo");var p=o.type;var m=o.hasOwnProperty("searchOperator");var v={};if(p=="owner"||p=="userCreator"){for(var B in b){var l=b[B];if(l=="value"&&z.is("select")){var s=z.val();if(!s){v[l]=""}else{v[l]=s.join(",")}}else{if(l=="value"&&z.is("input")){v[l]=z.val()}else{v[l]=jQuery('[name="'+l+'"]',n).val()}}}}else{if($.inArray(p,["picklist","multipicklist","modules","sharedOwner","multiReferenceValue","inventoryLimit","languages","currencyList","taxes","fileLocationType","categoryMultipicklist"])>-1){for(var B in b){var l=b[B];if(l=="value"&&z.is("input")){var u=z.val();var t=z.data("picklistvalues");var A=u.split(",");var r=[];for(x=0;x<A.length;x++){if(typeof t[A[x]]!="undefined"){r.push(t[A[x]])}else{r.push(A[x])}}var q=r.join(",");v[l]=q}else{if(l=="value"&&z.is("select")&&($.inArray(p,["picklist","multipicklist","modules","sharedOwner","multiReferenceValue","inventoryLimit","languages","currencyList","taxes","fileLocationType","categoryMultipicklist"])>-1)){var w=z.val();if(w==null){v[l]=w}else{v[l]=w.join(",")}}else{v[l]=jQuery('[name="'+l+'"]',n).val()}}}}else{for(var B in b){var l=b[B];if(l=="value"){v[l]=z.val()}else{v[l]=jQuery('[name="'+l+'"]',n).val()}}}}if(n.is(":last-child")){v.column_condition=""}a[g+1]["columns"][c]=v;c++});if(h.find("div.groupCondition").length>0){a[g+1]["condition"]=f.find('div.groupCondition [name="condition"]').val()}});return a},deleteConditionHandler:function(b){var a=jQuery(b.currentTarget);var c=a.closest(".conditionRow");c.remove()},registerAddCondition:function(){var a=this;this.getAddConditionElement().on("click",function(b){a.addConditionHandler(b)})},registerFieldChange:function(){var b=this.getFilterContainer();var a=this;b.on("change",'select[name="columnname"]',function(g,f){var d=jQuery(g.currentTarget);if(typeof f=="undefined"||f._intialize!=true){var h=d.closest("div.conditionRow");var c=h.find('select[name="comparator"]');c.empty()}a.loadConditions(d);a.loadFieldSpecificUi(d)})},registerConditionChange:function(){var b=this.getFilterContainer();var a=this;b.on("change",'select[name="comparator"]',function(g){var d=jQuery(g.currentTarget);var h=d.closest("div.conditionRow");var c=h.find('select[name="columnname"]');var f=c.find("option:selected");a.loadFieldSpecificUi(c);a.addValidationToFieldIfNeeded(c)})},registerDeleteCondition:function(){var a=this;var b=this.getFilterContainer();b.on("click",".deleteCondition",function(c){a.deleteConditionHandler(c)})},registerEvents:function(){this.registerAddCondition();this.registerFieldChange();this.registerDeleteCondition();this.registerConditionChange()}});Vtiger_Field_Js("AdvanceFilter_Field_Js",{},{getUiTypeSpecificHtml:function(){var a=this.getUiTypeModel();return a.getUi()},getModuleName:function(){var a=app.getModuleName();var b=this.getType();if($.inArray(b,["picklist","userCreator","multipicklist","owner","userCreator","modules","date","datetime","sharedOwner","multiReferenceValue","inventoryLimit","languages","currencyList","taxes","fileLocationType","categoryMultipicklist"])>-1){a="AdvanceFilter"}return a}});Vtiger_Picklist_Field_Js("AdvanceFilter_Picklist_Field_Js",{},{getUi:function(){var a='<select class="select2 row" multiple name="'+this.getName()+'[]">';var f=this.getPickListValues();var c=app.htmlDecode(this.getValue());var d=c.split(",");for(var b in f){a+='<option value="'+b+'" ';if(jQuery.inArray(b,d)!=-1){a+=" selected "}a+=">"+f[b]+"</option>"}a+="</select>";var e=jQuery(a);this.addValidationToElement(e);return e}});AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Modules_Field_Js",{},{});AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Inventorylimit_Field_Js",{},{});AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Filelocationtype_Field_Js",{},{});Vtiger_Multipicklist_Field_Js("AdvanceFilter_Multipicklist_Field_Js",{},{});Vtiger_Multipicklist_Field_Js("AdvanceFilter_Categorymultipicklist_Field_Js",{},{});AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Languages_Field_Js",{},{});AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Currencylist_Field_Js",{},{});AdvanceFilter_Multipicklist_Field_Js("AdvanceFilter_Taxes_Field_Js",{},{});Vtiger_Owner_Field_Js("AdvanceFilter_Owner_Field_Js",{},{getUi:function(){var g=this.get("comparatorElementVal");if((g=="e"||g=="n")||(this.getName()==="shownerid"&&jQuery.inArray(g,["c","k"])!=-1)){var f='<select class="select2 row" multiple name="'+this.getName()+'[]">';var i=this.getPickListValues();var c=app.htmlDecode(this.getValue());var a=c.split(",");for(var j in i){f+='<optgroup label="'+j+'">';var h=i[j];for(var e in h){f+='<option value="'+e+'" ';if(jQuery.inArray(e,a)!=-1){f+=" selected "}f+=">"+h[e]+"</option>"}f+="</optgroup>"}f+="</select>";var b=jQuery(f);this.addValidationToElement(b);return b}else{var c=this.getValue();var i=this.getPickListValues();var d=[];jQuery.each(i,function(k,l){jQuery.each(l,function(m,n){d.push(jQuery.trim(n))})});var f='<input data-tags="'+d+'" type="hidden" class="row select2" name="'+this.getName()+'">';var b=jQuery(f).val(c);b.data("tags",d);this.addValidationToElement(b);return b}}});Vtiger_Multireferencevalue_Field_Js("AdvanceFilter_Multireferencevalue_Field_Js",{},{});AdvanceFilter_Owner_Field_Js("AdvanceFilter_Sharedowner_Field_Js",{},{});AdvanceFilter_Owner_Field_Js("AdvanceFilter_Usercreator_Field_Js",{},{});Vtiger_Date_Field_Js("AdvanceFilter_Date_Field_Js",{},{getUi:function(){var m=this.get("comparatorElementVal");var i=this.get("dateSpecificConditions");if(m=="bw"||m=="custom"){var g='<div class="date"><input class="dateRangeField form-control" data-calendar-type="range" name="'+this.getName()+'" data-date-format="'+this.getDateFormat()+'" type="text" ReadOnly="true" value="'+this.getValue()+'"></div>';var a=jQuery(g);var s=a.find(".dateRangeField");if(s.val().indexOf(",")!==-1){var d=this.getValue().split(",");var p=d[0];var f=d[1];if(p.indexOf(" ")!==-1){var e=p.split(" ");p=e[0]}if(f.indexOf(" ")!==-1){var j=f.split(" ");f=j[0]}s.val(p+","+f)}else{var n=this.getValue().split(" ");var b=n[0];var q=n[0];if(b!=""&&q!=""){s.val(b+","+q)}}return this.addValidationToElement(a)}else{if(m in i){var k=i[m]["startdate"];var h=i[m]["enddate"];if(m=="today"||m=="tomorrow"||m=="yesterday"){var g='<input name="'+this.getName()+'" type="text" ReadOnly="true" value="'+k+'">'}else{var g='<input name="'+this.getName()+'" type="text" ReadOnly="true" value="'+k+","+h+'">'}return jQuery(g)}else{var o=this._super();var l=o.find(".dateField").val();var r=l.split(" ");if(r[1]=="00:00:00"){l=r[0]}else{if(m=="e"||m=="n"||m=="b"||m=="a"){var c=l.split(" ");l=c[0]}}o.find(".dateField").val(l);return o}}}});AdvanceFilter_Date_Field_Js("AdvanceFilter_Datetime_Field_Js",{},{});