
Vtiger_List_Js("Vtiger_FindDuplicates_Js",{massDeleteRecords:function(c){var d=new Vtiger_FindDuplicates_Js();var a=jQuery("#duplicateSearchFields").val();var b=jQuery("#ignoreEmpty").val();c+="&mode=FindDuplicates&fields="+a+"&ignoreEmpty="+b;Vtiger_List_Js.massDeleteRecords(c,d)}},{popupWindowInstance:false,postMassDeleteRecords:function(){var d=jQuery.Deferred();var g=this;var a=jQuery("#duplicateSearchFields").val();var f=app.getModuleName();var b=jQuery("#pageNumber").val();var c=jQuery("#ignoreEmpty").val();var e="module="+f+"&view=FindDuplicates&fields="+a+"&ignoreEmpty="+c;AppConnector.requestPjax(e+"&page="+b).then(function(i){jQuery("#listViewContents").html(i);jQuery("#recordsCount").val("");jQuery("#totalPageCount").text("");var h=[];g.writeSelectedIds(h);g.calculatePages().then(function(){g.updatePagination()});g.registerMergeRecordEvent(g.mergeRecordPopupCallback);d.resolve()});return d.promise()},registerPageNavigationEvents:function(){var e=this;var a=jQuery("#duplicateSearchFields").val();var d=app.getModuleName();var b=jQuery("#ignoreEmpty").val();var c="module="+d+"&view=FindDuplicates&fields="+a+"&ignoreEmpty="+b;jQuery("#listViewNextPageButton").on("click",function(){var h=jQuery("#pageLimit").val();var i=jQuery("#noOfEntries").val();if(i>=h){var f=jQuery("#pageNumber").val();var g=parseInt(parseFloat(f))+1;AppConnector.requestPjax(c+"&page="+g).then(function(j){jQuery("#listViewContents").html(j);jQuery("#pageNumber").val(g);jQuery("#pageToJump").val(g);e.calculatePages().then(function(){e.updatePagination(g)});e.registerMergeRecordEvent(e.mergeRecordPopupCallback)})}});jQuery("#listViewPreviousPageButton").on("click",function(){var f=jQuery("#pageNumber").val();if(f>1){var g=parseInt(parseFloat(f))-1;jQuery("#pageNumber").val(g);jQuery("#pageToJump").val(g);AppConnector.requestPjax(c+"&page="+g).then(function(h){jQuery("#listViewContents").html(h);e.calculatePages().then(function(){e.updatePagination(g)});e.registerMergeRecordEvent(e.mergeRecordPopupCallback)})}});jQuery(".pageNumber").on("click",function(){var g=$(this).hasClass("disabled");if(g){return false}var f=$(this).data("id");var h=parseInt(parseFloat(f))-1;jQuery("#pageNumber").val(h);jQuery("#pageToJump").val(h);AppConnector.requestPjax(c+"&page="+f).then(function(i){jQuery("#listViewContents").html(i);e.calculatePages().then(function(){e.updatePagination(f)});e.registerMergeRecordEvent(e.mergeRecordPopupCallback)},function(j,i){})});jQuery("#listViewPageJump").on("click",function(k){jQuery("#pageToJump").validationEngine("hideAll");var h=jQuery("#totalPageCount");var f=h.text();if(f==""){var j=jQuery("#totalCount").val();if(j!="undefined"){var g=jQuery("#noOfEntries").val();if(g=="0"){g=1}var i=Math.ceil(j/g);if(i==0){i=1}h.text(i);return}h.progressIndicator({});e.getPageCount().then(function(m){var l=m.result["page"];if(l==0){l=1}h.text(l);h.progressIndicator({mode:"hide"})})}});jQuery("#listViewPageJumpDropDown").on("click","li",function(f){f.stopImmediatePropagation()}).on("keypress","#pageToJump",function(m){if(m.which==13){m.stopImmediatePropagation();var j=jQuery(m.currentTarget);var i=Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(j);if(typeof i!="undefined"){j.validationEngine("showPrompt",i,"","topLeft",true)}else{j.validationEngine("hideAll");var h=jQuery("#pageNumber");var f=h.val();var k=parseInt(jQuery(m.currentTarget).val());var l=parseInt(jQuery("#totalPageCount").text());if(k>l){var n=app.vtranslate("JS_PAGE_NOT_EXIST");j.validationEngine("showPrompt",n,"","topLeft",true);return}if(k==f){var o=app.vtranslate("JS_YOU_ARE_IN_PAGE_NUMBER")+" "+k;var g={text:o,type:"info"};Vtiger_Helper_Js.showMessage(g);return}h.val(k);AppConnector.requestPjax(c+"&page="+k).then(function(p){jQuery("#listViewContents").html(p);e.updatePagination(k);j.closest(".btn-group").removeClass("open");e.registerMergeRecordEvent(e.mergeRecordPopupCallback)})}return false}})},registerMergeRecordEvent:function(a){var b=this;jQuery('input[name="merge"]').on("click",function(j){var g=jQuery(j.currentTarget);var l=g.data("group");var d=jQuery('input[name="mergeRecord"]:checked');if(d.length<2){Vtiger_Helper_Js.showMessage({text:app.vtranslate("JS_SELECT_ATLEAST_TWO_RECORD_FOR_MERGING")});return false}else{var i=0;var f=[];var k=false;d.each(function(e,n){var m=jQuery(n);if(m.data("group")!=l){Vtiger_Helper_Js.showMessage({text:app.vtranslate("JS_SELECT_RECORDS_TO_MERGE_FROM_SAME_GROUP")});k=true;return false}f.push(m.data("id"));i++});if(k){return false}if(i>3){Vtiger_Helper_Js.showMessage({text:app.vtranslate("JS_ALLOWED_TO_SELECT_MAX_OF_THREE_RECORDS")});return false}var h=Vtiger_Popup_Js.getInstance();var c="module="+app.getModuleName()+"&view=MergeRecord&records="+f;b.popupWindowInstance=h.show(c,"","","",function(e){b.mergeRecordPopupCallback()})}})},mergeRecordPopupCallback:function(){var b=this;var c=b.popupWindowInstance;var a=c.document.forms.massMerge;jQuery(a.primaryRecord).on("change",function(d){var e=jQuery(d.currentTarget).val();jQuery(a).find("[data-id="+e+"]").attr("checked",true)});jQuery(a).on("submit",function(d){d.preventDefault();var f=jQuery(a).serialize();AppConnector.request(f).then(function(e){c.close();b.postMassDeleteRecords()})})},registerEvents:function(){var a=this;a.registerMergeRecordEvent(a.mergeRecordPopupCallback);a.registerMainCheckBoxClickEvent();a.registerPageNavigationEvents();a.registerCheckBoxClickEvent();a.registerSelectAllClickEvent();a.registerDeselectAllClickEvent();a.registerEventForTotalRecordsCount()},getCurrentCvId:function(){return jQuery("#viewName").val()},getRecordsCount:function(){var d=jQuery.Deferred();var f=jQuery("#recordsCount").val();if(f!=""){d.resolve(f)}else{var h="";var e=app.getModuleName();var g=app.getParentModuleName();var a=jQuery("#duplicateSearchFields").val();var c=jQuery("#ignoreEmpty").val();var b={module:e,parent:g,view:"FindDuplicatesAjax",mode:"getRecordsCount",fields:a,ignoreEmpty:c};AppConnector.request(b).then(function(j){var i=JSON.parse(j);jQuery("#recordsCount").val(i.result["count"]);h=i.result["count"];d.resolve(h)},function(i,j){})}return d.promise()}});