
Vtiger_List_Js("Reports_List_Js",{listInstance:false,addReport:function(a){var b=Reports_List_Js.listInstance;window.location.href=a+"&folder="+b.getCurrentCvId()},triggerAddFolder:function(a){var c=a;var b=jQuery.progressIndicator();AppConnector.request(c).then(function(e){b.progressIndicator({mode:"hide"});var d=function(f){jQuery("#addFolder").validationEngine({onValidationComplete:function(h,g){return g}});Reports_List_Js.listInstance.folderSubmit().then(function(i){if(i.success){var g=i.result;if(g.success){app.hideModalWindow();var j=g.info;Reports_List_Js.listInstance.updateCustomFilter(j)}else{g=g.message;var h=jQuery("#foldername");h.validationEngine("showPrompt",g,"error","topLeft",true)}}else{app.hideModalWindow();var k={title:app.vtranslate("JS_ERROR"),text:i.error.message};Vtiger_Helper_Js.showPnotify(k)}})};app.showModalWindow(e,function(f){if(typeof d=="function"){d(f)}})})},massDelete:function(d){var f=Reports_List_Js.listInstance;var c=f.checkListRecordSelected();if(c!=true){var b=f.readSelectedIds(true);var g=f.readExcludedIds(true);var a=f.getCurrentCvId();var e=app.vtranslate("LBL_DELETE_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:e}).then(function(j){var i=d+"&viewname="+a+"&selected_ids="+b+"&excluded_ids="+g;var k=app.vtranslate("JS_RECORDS_ARE_GETTING_DELETED");var h=jQuery.progressIndicator({message:k,position:"html",blockInfo:{enabled:true}});AppConnector.request(i).then(function(l){h.progressIndicator({mode:"hide"});if(l){f.massActionPostOperations(l)}})},function(h,i){})}else{f.noRecordSelectedAlert()}},massMove:function(b){var a=Reports_List_Js.listInstance;var d=a.checkListRecordSelected();if(d!=true){var h=a.readSelectedIds(true);var i=a.readExcludedIds(true);var c=a.getCurrentCvId();var e={selected_ids:h,excluded_ids:i,viewname:c};var f={url:b,data:e};var g=jQuery.progressIndicator();AppConnector.request(f).then(function(k){g.progressIndicator({mode:"hide"});var j=function(m){var l=new Reports_List_Js();l.moveReports().then(function(n){if(n){a.massActionPostOperations(n)}})};app.showModalWindow(k,j)})}else{a.noRecordSelectedAlert()}}},{init:function(){Reports_List_Js.listInstance=this},folderSubmit:function(){var a=jQuery.Deferred();jQuery("#addFolder").on("submit",function(d){var b=jQuery(d.currentTarget).validationEngine("validate");if(b==true){var c=jQuery(d.currentTarget).serializeFormData();AppConnector.request(c).then(function(e){a.resolve(e)})}d.preventDefault()});return a.promise()},moveReports:function(){var a=jQuery.Deferred();jQuery("#moveReports").on("submit",function(c){var b=jQuery(c.currentTarget).serializeFormData();AppConnector.request(b).then(function(d){a.resolve(d)});c.preventDefault()});return a.promise()},updateCustomFilter:function(g){var e=this;var b=g.folderId;var d=jQuery("#customFilter");var c=this.constructOptionElement(g);var f="filterOptionId_"+b;var a=jQuery("#"+f);if(a.length>0){a.replaceWith(c);app.showSelect2ElementView(d)}else{d.find("#foldersBlock").append(c);app.showSelect2ElementView(d);this.filterBlock=false;e.registerCustomFilterOptionsHoverEvent();e.registerDeleteFilterClickEvent();e.registerEditFilterClickEvent()}},constructOptionElement:function(a){return'<option data-editable="'+a.isEditable+'" data-deletable="'+a.isDeletable+'" data-editurl="'+a.editURL+'" data-deleteurl="'+a.deleteURL+'" class="filterOptionId_'+a.folderId+'" id="filterOptionId_'+a.folderId+'" value="'+a.folderId+'" data-id="'+a.folderId+'">'+a.folderName+"</option>"},massActionPostOperations:function(d){var c=this;var a=this.getCurrentCvId();if(d.success){var b=app.getModuleName();AppConnector.request("index.php?module="+b+"&view=List&viewname="+a).then(function(f){jQuery("#recordsCount").val("");jQuery("#totalPageCount").text("");app.hideModalWindow();var g=c.getListViewContentContainer();g.html(f);jQuery("#deSelectAllMsg").trigger("click");c.calculatePages().then(function(){c.updatePagination()})})}else{app.hideModalWindow();var e={title:app.vtranslate("JS_LBL_PERMISSION"),text:d.error.message+" : "+d.error.code};Vtiger_Helper_Js.showPnotify(e)}},deleteFolder:function(c,a){var b=this;AppConnector.request(a).then(function(i){if(i.success){var f=i.result;if(f.success){var k=jQuery(c.currentTarget).closest(".select2-results__option");var e=b.getSelectOptionFromChosenOption(k);var h=e.data("deleteurl");var d='<form action="index.php?module=Reports&view=List" method="POST">';if(typeof csrfMagicName!=="undefined"){d+='<input type = "hidden" name ="'+csrfMagicName+"\"  value='"+csrfMagicToken+"'>"}d+="</form>";var g=jQuery(d);g.appendTo("body").submit()}else{var j={title:app.vtranslate("JS_INFORMATION"),text:f.message};Vtiger_Helper_Js.showPnotify(j)}}else{app.hideModalWindow();Vtiger_Helper_Js.showPnotify({title:app.vtranslate("JS_INFORMATION"),text:i.error.message})}})},registerEditFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();b.on("mouseup","li span.editFilter",function(d){var f=jQuery(d.currentTarget).closest(".select2-results__option");var c=a.getSelectOptionFromChosenOption(f);var e=c.data("editurl");Reports_List_Js.triggerAddFolder(e);d.stopPropagation()})},registerDeleteFilterClickEvent:function(){var a=this;var b=this.getFilterBlock();b.on("mouseup","li span.deleteFilter",function(d){a.getFilterSelectElement().data("select2").close();var e=jQuery(d.currentTarget).closest(".select2-results__option");var c=app.vtranslate("JS_LBL_ARE_YOU_SURE_YOU_WANT_TO_DELETE");Vtiger_Helper_Js.showConfirmationBox({message:c}).then(function(h){var f=a.getSelectOptionFromChosenOption(e);var g=f.data("deleteurl");a.deleteFolder(d,g)},function(f,g){});d.stopPropagation()})},registerEvents:function(){this._super()}});