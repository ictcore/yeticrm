jQuery(function(){if($("#OSSMailBoxInfo").data("numberunreademails")!=undefined){window.stopScanMails=false;if(getUrlVars()["view"]!="Popup"){startCheckMails()}}if($("#OSSMailBoxInfo select").length>0){registerUserList()}});function registerUserList(){var b=$("#OSSMailBoxInfo select");if(b.data("select2")){b.select2("destroy")}else{b.on("change",function(){var c={module:"OSSMail",action:"SetUser",user:$(this).val(),};AppConnector.request(c).then(function(d){if(app.getModuleName()=="OSSMail"){location.reload()}else{window.location.href="index.php?module=OSSMail&view=index"}})})}app.showSelect2ElementView(b,{templateResult:function(e){if(!e.id){return e.text}var d=jQuery(e.element);var f=d.data("nomail")?" ("+d.data("nomail")+")":"";var c=$("<span>"+e.text+'<span class"text-left"><span>'+f+"</span>");return c},templateSelection:function(e){var d=jQuery(e.element);var f=d.data("nomail")?" ("+d.data("nomail")+")":"";var c=jQuery("<span></span>");c.append(e.text+f);return c},closeOnSelect:true});var a=b.data("select2");a.$dropdown.on("mouseup","li",function(c){if(jQuery(c.currentTarget).attr("aria-selected")=="true"){b.trigger("change")}});a.$container.find(".select2-selection__rendered").on("mousedown",function(c){c.stopPropagation();b.trigger("change")})}function startCheckMails(){var c=[];var b=$("#OSSMailBoxInfo").data("interval");$("#OSSMailBoxInfo .noMails").each(function(d){c.push($(this).data("id"))});if(c.length>0){checkMails(c);var a=setInterval(function(){if(window.stopScanMails==false){checkMails(c)}else{clearInterval(a)}},b*1000)}}function checkMails(c){var b={module:"OSSMail",action:"checkMails",users:c,};var a=false;AppConnector.request(b).then(function(e){if(e.success&&e.success.error!=true&&e.result.error!=true){var d=e.result;$("#OSSMailBoxInfo .noMails").each(function(g){var h=jQuery(this);var j=h.data("id");if(jQuery.inArray(j,d)){var f=d[j];if(h.is("option")){h.data("nomail",f);a=true}else{var i="";if(f>0){i="("+f+")"}h.text(i)}}});if(a){registerUserList()}}else{window.stopScanMails=true}},function(e,d){window.stopScanMails=true})}function getUrlVars(){var b={};var a=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(c,d,e){b[d]=e});return b};