
Vtiger_Edit_Js("Documents_Edit_Js",{},{INTERNAL_FILE_LOCATION_TYPE:"I",EXTERNAL_FILE_LOCATION_TYPE:"E",getMaxiumFileUploadingSize:function(a){return a.find(".maxUploadSize").data("value")},isFileLocationInternalType:function(a){if(a.val()==this.INTERNAL_FILE_LOCATION_TYPE){return true}return false},isFileLocationExternalType:function(a){if(a.val()==this.EXTERNAL_FILE_LOCATION_TYPE){return true}return false},convertFileSizeInToDisplayFormat:function(c){var b=-1;var a=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do{c=c/1024;b++}while(c>1024);return Math.max(c,0.1).toFixed(1)+a[b]},registerFileLocationTypeChangeEvent:function(a){var b=this;a.on("change",'select[name="filelocationtype"]',function(i){var f=a.find('[name="filelocationtype"]');var l=a.find('[name="filename"]');var d;if(b.isFileLocationInternalType(f)){d=jQuery('<input type="file"/>')}else{d=jQuery('<input type="text" />')}var m=l.get(0).attributes;for(var h=0;h<m.length;h++){var g=m[h];if(g.name=="type"||g.name=="value"||g.name=="class"){continue}var k=g.value;var j="";if(g.name=="data-fieldinfo"){k=JSON.parse(k);if(b.isFileLocationExternalType(f)){k.type="url";j="form-control"}else{k.type="file"}k=JSON.stringify(k)}d.attr(g.name,k);d.addClass(j)}l.replaceWith(d);var c=d.closest(".fieldValue");var n=c.find(".uploadedFileDetails");if(b.isFileLocationExternalType(f)){n.addClass("hide").removeClass("show")}else{n.addClass("show").removeClass("hide")}})},registerFileChangeEvent:function(a){var b=this;a.on("change",'input[name="filename"]',function(g){if(g.target.type=="text"){return false}file=g.target.files[0];var d=a.find('[name="filename"]');if(d.attr("type")!="file"){return}var f=d.closest(".fileUploadContainer").find(".uploadedFileSize");var c=d.get(0).files[0].size;var h=b.getMaxiumFileUploadingSize(a);if(c>h){alert(app.vtranslate("JS_EXCEEDS_MAX_UPLOAD_SIZE"));d.val("");f.text("")}else{f.text(b.convertFileSizeInToDisplayFormat(c))}})},quickCreateSave:function(d){var c=this;var b=jQuery.Deferred();var e=new FormData(d[0]);var a=d.find('[name="filelocationtype"]');if(typeof file!="undefined"&&c.isFileLocationInternalType(a)){e.append("filename",file);delete file}if(e){var f={url:"index.php",type:"POST",data:e,processData:false,contentType:false};AppConnector.request(f).then(function(g){b.resolve(g)},function(h,g){b.reject(h,g)})}return b.promise()},registerBasicEvents:function(a){this._super(a);this.registerFileLocationTypeChangeEvent(a);this.registerFileChangeEvent(a)},registerEvents:function(){this._super()}});