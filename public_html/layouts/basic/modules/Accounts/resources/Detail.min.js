
Vtiger_Detail_Js("Accounts_Detail_Js",{},{accountHierarchyResponseCache:{},getAccountHierarchyResponseData:function(c){var b=this;var a=jQuery.Deferred();if(!(jQuery.isEmptyObject(b.accountHierarchyResponseCache))){a.resolve(b.accountHierarchyResponseCache)}else{AppConnector.request(c).then(function(d){b.accountHierarchyResponseCache=d;a.resolve(b.accountHierarchyResponseCache)})}return a.promise()},registerButtons:function(a){a.find(".toChangeBtn").on("click",function(d){var c=$(d.currentTarget);var b=c.data("fieldname");var f={value:c.hasClass("btn-success")?0:1,field:b,record:c.data("recordId"),module:app.getModuleName(),action:"SaveAjax"};AppConnector.request(f).then(function(e){if(c.hasClass("btn-warning")){c.removeClass("btn-warning");c.addClass("btn-success")}else{c.addClass("btn-warning");c.removeClass("btn-success")}c.html(e.result[b].display_value);var g={title:app.vtranslate("JS_LBL_PERMISSION"),text:app.vtranslate("JS_SAVE_NOTIFY_OK"),type:"success",animation:"show"};Vtiger_Helper_Js.showMessage(g)})})},displayAccountHierarchyResponseData:function(b){var a=this;app.showModalWindow(b,function(d){var c=d.find(".maxHeightModal");app.showScrollBar(c,{height:c.height,railVisible:true,size:"6px"});a.registerButtons(d)})},registerHierarchyRecordCount:function(){var a=$(".detailViewTitle .hierarchy");if(a.length){var b={module:app.getModuleName(),action:"RelationAjax",record:app.getRecordId(),mode:"getHierarchyCount",};AppConnector.request(b).then(function(c){if(c.success){$(".detailViewTitle .hierarchy .badge").html(c.result)}})}},registerShowHierarchy:function(){var c=this;var b=$(".detailViewTitle");var a="index.php?module=Accounts&view=AccountHierarchy&record="+app.getRecordId();b.on("click",".detailViewIcon, .recordLabelValue",function(d){c.getAccountHierarchyResponseData(a).then(function(e){c.displayAccountHierarchyResponseData(e)})})},registerEvents:function(){this._super();this.registerHierarchyRecordCount();this.registerShowHierarchy()}});