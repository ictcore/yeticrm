
var Settings_Picklist_Js={registerModuleChangeEvent:function(){jQuery("#pickListModules").on("change",function(d){var b=jQuery(d.currentTarget);var a=jQuery(d.currentTarget).val();if(a.length<=0){Settings_Vtiger_Index_Js.showMessage({type:"error",text:app.vtranslate("JS_PLEASE_SELECT_MODULE")});return}var f={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:a,view:"IndexAjax",mode:"getPickListDetailsForModule"};var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});console.log(f);AppConnector.request(f).then(function(e){console.log(e);jQuery("#modulePickListContainer").html(e);c.progressIndicator({mode:"hide"});app.changeSelectElementView(jQuery("#modulePickListContainer"));Settings_Picklist_Js.registerModulePickListChangeEvent();jQuery("#modulePickList").trigger("change")})})},registerModulePickListChangeEvent:function(){jQuery("#modulePickList").on("change",function(b){var c={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),view:"IndexAjax",mode:"getPickListValueForField",pickListFieldId:jQuery(b.currentTarget).val()};var a=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(c).then(function(d){jQuery("#modulePickListValuesContainer").html(d);app.showSelect2ElementView(jQuery("#rolesList"));Settings_Picklist_Js.registerItemActions();a.progressIndicator({mode:"hide"})})})},registerAddItemEvent:function(){jQuery("#addItem").on("click",function(d){var c=jQuery("#createViewContents").find(".modal");var a=c.clone(true,true).removeClass("basicCreateView").addClass("createView");a.find(".rolesList").addClass("select2");var b=function(e){jQuery('[name="addItemForm"]',e).validationEngine();Settings_Picklist_Js.registerAddItemSaveEvent(e);Settings_Picklist_Js.regiserSelectRolesEvent(e)};app.showModalWindow(a,function(e){if(typeof b=="function"){b(e)}})})},registerAssingValueToRuleEvent:function(){jQuery("#assignValue").on("click",function(){var a=jQuery("#pickListValuesTable");var d=jQuery(".selectedListItem",a);if(d.length>0){var b=[];jQuery.each(d,function(f,e){b.push(jQuery(e).closest("tr").data("key"))})}var c={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),view:"IndexAjax",mode:"showAssignValueToRoleView",pickListFieldId:jQuery("#modulePickList").val()};AppConnector.request(c).then(function(e){app.showModalWindow(e);jQuery('[name="addItemForm"]',jQuery(e)).validationEngine();Settings_Picklist_Js.registerAssignValueToRoleSaveEvent(jQuery(e));if(d.length>0){jQuery('[name="assign_values[]"]',jQuery("#assignValueToRoleForm")).select2("val",b)}})})},registerAssignValueToRoleSaveEvent:function(a){jQuery("#assignValueToRoleForm").on("submit",function(i){var b=jQuery(i.currentTarget);var j=jQuery('[name="assign_values[]"]',b);var c=app.getSelect2ElementFromSelect(j);var f=Vtiger_MultiSelect_Validator_Js.invokeValidation(j);if(f!=true){c.validationEngine("showPrompt",f,"error","topLeft",true)}else{c.validationEngine("hide")}var h=jQuery('[name="rolesSelected[]"]',b);var g=app.getSelect2ElementFromSelect(h);var k=Vtiger_MultiSelect_Validator_Js.invokeValidation(h);if(k!=true){g.validationEngine("showPrompt",k,"error","bottomLeft",true)}else{g.validationEngine("hide")}if(f!=true||k!=true){i.preventDefault();return}else{b.find('[name="saveButton"]').attr("disabled","disabled")}var d=jQuery(i.currentTarget).serializeFormData();AppConnector.request(d).then(function(e){if(typeof e.result!="undefined"){app.hideModalWindow();Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_VALUE_ASSIGNED_SUCCESSFULLY"),type:"success"})}});i.preventDefault()})},registerEnablePickListValueClickEvent:function(){jQuery("#listViewContents").on("click",".assignToRolePickListValue",function(b){jQuery("#saveOrder").removeAttr("disabled");var a=jQuery(b.currentTarget);if(a.hasClass("selectedCell")){a.removeClass("selectedCell").addClass("unselectedCell");a.find(".glyphicon-ok").remove()}else{a.removeClass("unselectedCell").addClass("selectedCell");a.prepend('<span class="glyphicon glyphicon-ok pull-left"></span>')}})},registerenableOrDisableListSaveEvent:function(){jQuery("#saveOrder").on("click",function(d){var c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true,elementToBlock:jQuery(".tab-content")}});var g=jQuery(".assignToRolePickListValue");var b=[];var a=[];jQuery.each(g,function(h,e){var j=jQuery(e);if(j.hasClass("selectedCell")){a.push(j.data("id"))}else{b.push(j.data("id"))}});var f={module:app.getModuleName(),parent:app.getParentModuleName(),action:"SaveAjax",mode:"enableOrDisable",enabled_values:a,disabled_values:b,picklistName:jQuery('[name="picklistName"]').val(),rolesSelected:jQuery("#rolesList").val()};AppConnector.request(f).then(function(e){if(typeof e.result!="undefined"){jQuery(d.currentTarget).attr("disabled","disabled");c.progressIndicator({mode:"hide"});Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_LIST_UPDATED_SUCCESSFULLY"),type:"success"})}})})},regiserSelectRolesEvent:function(a){a.find('[name="rolesSelected[]"]').on("change",function(c){var d=jQuery(c.currentTarget);var b=d.val();if(jQuery.inArray("all",b)!=-1){d.select2("val","");d.select2("val","all");d.select2("close");d.find("option").not(":first").attr("disabled","disabled");a.find(jQuery(".modal-body")).append('<div class="alert alert-info textAlignCenter">'+app.vtranslate("JS_ALL_ROLES_SELECTED")+"</div>")}else{d.find("option").removeAttr("disabled","disabled");a.find(".modal-body").find(".alert").remove()}})},registerRenameItemEvent:function(){var a=this;jQuery("#renameItem").on("click",function(c){var b=jQuery("#pickListValuesTable");var g=jQuery(".selectedListItem",b);var f=g.length;if(f>1){var d={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_MORE_THAN_ONE_ITEM_SELECTED"),animation:"show",type:"error"};Vtiger_Helper_Js.showPnotify(d);return}else{var d={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),view:"IndexAjax",mode:"showEditView",pickListFieldId:jQuery("#modulePickList").val(),fieldValue:g.closest("tr").data("key")};AppConnector.request(d).then(function(h){app.showModalWindow(h);var e=jQuery("#renameItemForm");a.registerScrollForNonEditablePicklistValues(e);e.validationEngine();Settings_Picklist_Js.registerRenameItemSaveEvent()})}})},registerScrollForNonEditablePicklistValues:function(a){jQuery(a).find(".nonEditablePicklistValues").slimScroll({height:"70px",size:"6px"})},registerDeleteItemEvent:function(){var a=this;jQuery("#deleteItem").on("click",function(d){var b=jQuery("#pickListValuesTable");var h=jQuery(".selectedListItem",b);var c=[];jQuery.each(h,function(e,i){c.push(jQuery(i).closest("tr").data("key"))});var g=jQuery(".pickListValue",b);if(g.length==h.length){Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_YOU_CANNOT_DELETE_ALL_THE_VALUES"),type:"error"});return}var f={module:app.getModuleName(),parent:app.getParentModuleName(),source_module:jQuery("#pickListModules").val(),view:"IndexAjax",mode:"showDeleteView",pickListFieldId:jQuery("#modulePickList").val(),fieldValue:JSON.stringify(c)};a.showDeleteItemForm(f)})},registerDeleteOptionEvent:function(){function a(c){var b=jQuery("#replaceValue");if(typeof c.added!="undefined"){var e=c.added.id;jQuery('#replaceValue option[value="'+e+'"]').remove();b.trigger("chosen:updated")}else{var e=c.removed.id;var d=c.removed.text;b.append('<option value="'+e+'">'+d+"</option>");b.trigger("chosen:updated")}}jQuery('[name="delete_value[]"]').on("change",function(b){a({val:b.val,added:b.added,removed:b.removed})})},duplicateItemNameCheck:function(a){var h=JSON.parse(jQuery('[name="pickListValues"]',a).val());var d=[];jQuery.each(h,function(k,l){var j=app.getDecodedValue(l);d.push(jQuery.trim(j.toLowerCase()))});var g=jQuery('[name="mode"]',a).val();var f=jQuery.trim(jQuery('[name="newValue"]',a).val());var c=f.toLowerCase();if(jQuery.inArray(c,d)!=-1){if(g=="rename"){var b=jQuery.trim(jQuery('[name="oldValue"]',a).val());var e=b.toLowerCase();if(b!=f&&e==c){return false}}return true}else{return false}},registerChangeRoleEvent:function(){jQuery("#rolesList").on("change",function(c){var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true,elementToBlock:jQuery(".tab-content")}});var a=jQuery(c.currentTarget);var d={module:app.getModuleName(),parent:app.getParentModuleName(),view:"IndexAjax",mode:"getPickListValueByRole",rolesSelected:a.val(),pickListFieldId:jQuery("#modulePickList").val(),sourceModule:jQuery('input[name="source_module"]').val()};AppConnector.request(d).then(function(e){jQuery("#pickListValeByRoleContainer").html(e);Settings_Picklist_Js.registerenableOrDisableListSaveEvent();b.progressIndicator({mode:"hide"})})})},registerAddItemSaveEvent:function(a){a.find('[name="addItemForm"]').on("submit",function(h){var c=jQuery(h.currentTarget);var d=c.validationEngine("validate");if(d==true){var j=Settings_Picklist_Js.duplicateItemNameCheck(a);if(j==true){var g=app.vtranslate("JS_DUPLIACATE_ENTRIES_FOUND_FOR_THE_VALUE");var k=jQuery('[name="newValue"]',a);var b=k.val();k.validationEngine("showPrompt",g+' "'+b+'"',"error","bottomLeft",true);h.preventDefault();return}var i=c.data("jqv").InvalidFields;if(i.length==0){c.find('[name="saveButton"]').attr("disabled","disabled")}var f=jQuery(h.currentTarget).serializeFormData();var b=f.newValue;f.newValue=jQuery.trim(b);AppConnector.request(f).then(function(m){m=m.result;var n=jQuery.trim(jQuery('[name="newValue"]',a).val());var r=jQuery("#dragImagePath").val();var q='<tr class="pickListValue cursorPointer"><td class="textOverflowEllipsis"><img class="alignMiddle" src="'+r+'" />&nbsp;&nbsp;'+n+"</td></tr>";var p=jQuery(q).appendTo(jQuery("#pickListValuesTable").find("tbody"));p.attr("data-key",n);p.attr("data-key-id",m.id);app.hideModalWindow();var o={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_ITEM_ADDED_SUCCESSFULLY"),animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(o);var e=jQuery('[name="pickListValues"]');var l=JSON.parse(e.val());l[m.id]=n;e.val(JSON.stringify(l))})}h.preventDefault()})},registerRenameItemSaveEvent:function(){jQuery("#renameItemForm").on("submit",function(j){var d=jQuery(j.currentTarget);var f=d.validationEngine("validate");if(f==true){var l=Settings_Picklist_Js.duplicateItemNameCheck(d);var m=jQuery('[name="newValue"]',d);var c=jQuery.trim(m.val());if(l==true){var i=app.vtranslate("JS_DUPLIACATE_ENTRIES_FOUND_FOR_THE_VALUE");m.validationEngine("showPrompt",i+' "'+c+'"',"error","bottomLeft",true);j.preventDefault();return}var g=jQuery('[name="oldValue"]',d);var a=g.val();var b=g.find('option[value="'+a+'"]').data("id");var h=jQuery(j.currentTarget).serializeFormData();h.newValue=c;h.id=b;var k=d.data("jqv").InvalidFields;if(k.length==0){d.find('[name="saveButton"]').attr("disabled","disabled")}AppConnector.request(h).then(function(p){if(typeof p.result!="undefined"){app.hideModalWindow();var n=a.replace(/"/g,'\\"');var s=jQuery("#dragImagePath").val();var r='<tr class="pickListValue cursorPointer"><td class="textOverflowEllipsis"><img class="alignMiddle" src="'+s+'" />&nbsp;&nbsp;'+c+"</td></tr>";var r=jQuery(r).attr("data-key",c).attr("data-key-id",b);jQuery('[data-key="'+n+'"]').replaceWith(r);var q={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_ITEM_RENAMED_SUCCESSFULLY"),animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(q);var e=jQuery('[name="pickListValues"]');var o=JSON.parse(e.val());o[b]=m.val();e.val(JSON.stringify(o))}})}j.preventDefault()})},showDeleteItemForm:function(c){var b=this;AppConnector.request(c).then(function(d){app.showModalWindow(d,function(e){if(typeof a=="function"){a(e)}})});var a=function(e){var d=e.find("#deleteItemForm");b.registerScrollForNonEditablePicklistValues(d);var f=jQuery("#pickListValuesCount").val()-1;app.changeSelectElementView(jQuery('[name="delete_value[]"]'),"select2",{maximumSelectionLength:f,dropdownCss:{"z-index":100001}});Settings_Picklist_Js.registerDeleteOptionEvent();var g=app.getvalidationEngineOptions(true);g.onValidationComplete=function(l,k){if(k){var j=jQuery('[name="delete_value[]"]');var i=app.getSelect2ElementFromSelect(j);var h=Vtiger_MultiSelect_Validator_Js.invokeValidation(j);if(h!=true){i.validationEngine("showPrompt",h,"error","topLeft",true);return}else{i.validationEngine("hide");l.find('[name="saveButton"]').attr("disabled","disabled")}var m=jQuery('[name="delete_value[]"]').val();var n=l.serializeFormData();AppConnector.request(n).then(function(q){if(typeof q.result!="undefined"){app.hideModalWindow();var o=jQuery('[name="pickListValues"]');var p=JSON.parse(o.val());jQuery.each(m,function(t,u){var s=u.replace(/"/g,'\\"');jQuery('[data-key-id="'+s+'"]').remove();delete p[u]});o.val(JSON.stringify(p));var r={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_ITEMS_DELETED_SUCCESSFULLY"),animation:"show",type:"success"};Vtiger_Helper_Js.showPnotify(r)}})}return false};d.validationEngine(g)}},registerSelectPickListValueEvent:function(){jQuery("#pickListValuesTable").on("click",".pickListValue",function(c){var a=jQuery(c.currentTarget);var b=a.find("td");c.preventDefault();if(c.ctrlKey){b.toggleClass("selectedListItem")}else{jQuery(".pickListValue").find("td").not(b).removeClass("selectedListItem");b.toggleClass("selectedListItem")}})},registerPickListValuesSortableEvent:function(){var a=jQuery("tbody",jQuery("#pickListValuesTable"));a.sortable({helper:function(c,b){b.children().each(function(d,e){e=jQuery(e);e.width(e.width())});return b},containment:a,revert:true,update:function(c,b){jQuery("#saveSequence").removeAttr("disabled")}})},registerSaveSequenceClickEvent:function(){jQuery("#saveSequence").on("click",function(c){var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true,elementToBlock:jQuery(".tab-content")}});var a={};var f=jQuery("#pickListValuesTable").find(".pickListValue");jQuery.each(f,function(g,e){a[jQuery(e).data("key-id")]=++g});var d={module:app.getModuleName(),parent:app.getParentModuleName(),action:"SaveAjax",mode:"saveOrder",picklistValues:a,picklistName:jQuery('[name="picklistName"]').val()};AppConnector.request(d).then(function(e){if(typeof e.result!="undefined"){jQuery("#saveSequence").attr("disabled","disabled");b.progressIndicator({mode:"hide"});Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_SEQUENCE_UPDATED_SUCCESSFULLY"),type:"success"})}})})},registerAssingValueToRoleTabClickEvent:function(){jQuery("#assignedToRoleTab").on("click",function(a){jQuery("#rolesList").trigger("change")})},registerItemActions:function(){Settings_Picklist_Js.registerAddItemEvent();Settings_Picklist_Js.registerRenameItemEvent();Settings_Picklist_Js.registerDeleteItemEvent();Settings_Picklist_Js.registerSelectPickListValueEvent();Settings_Picklist_Js.registerAssingValueToRuleEvent();Settings_Picklist_Js.registerChangeRoleEvent();Settings_Picklist_Js.registerAssingValueToRoleTabClickEvent();Settings_Picklist_Js.registerPickListValuesSortableEvent();Settings_Picklist_Js.registerSaveSequenceClickEvent()},registerEvents:function(){Settings_Picklist_Js.registerModuleChangeEvent();Settings_Picklist_Js.registerModulePickListChangeEvent();Settings_Picklist_Js.registerItemActions();Settings_Picklist_Js.registerEnablePickListValueClickEvent()}};jQuery(document).ready(function(){Settings_Picklist_Js.registerEvents()});Vtiger_Base_Validator_Js("Vtiger_FieldLabel_Validator_Js",{invokeValidation:function(e,f,d,c){var a=new Vtiger_FieldLabel_Validator_Js();a.setElement(e);var b=a.validate();if(b!=true){return a.getError()}}},{validate:function(){var a=this.getFieldValue();return this.validateValue(a)},validateValue:function(b){var a=/[<\>\"\,]/;if(a.test(b)){var c=app.vtranslate("JS_SPECIAL_CHARACTERS")+' < > " , '+app.vtranslate("JS_NOT_ALLOWED");this.setError(c);return false}return true}});