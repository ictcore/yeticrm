
var Settings_Index_Js={initEvants:function(){$(".LangManagement .add_lang").click(Settings_Index_Js.ShowLangMondal);$(".LangManagement .edit_lang a").click(function(a){jQuery("#edit_lang").html("");document.showDiff=false;Settings_Index_Js.LoadEditLang(this)});$(".LangManagement .editHelpIcon a").click(function(a){jQuery("#editHelpIcon").html("");document.showDiff=false;Settings_Index_Js.LoadEditLang(this)});$(".AddNewLangMondal .btn-primary").click(Settings_Index_Js.AddLangMondal);$(".AddNewTranslationMondal .btn-primary").click(Settings_Index_Js.AddTranslationMondal);$("#lang_list tr").each(function(a,b){b=$(b);Settings_Index_Js.initEvant(b)})},LoadEditLang:function(g){var f=jQuery(g);var a=f.attr("href");var d=f.data("mode");if(typeof a=="undefined"){a="#"+f.attr("id")}var c=$.progressIndicator({message:app.vtranslate("LBL_Loader"),position:a,blockInfo:{enabled:true}});var b="";if($(".LangManagement "+a+" #langs_list").val()!=undefined){b+="&lang="+$(".LangManagement "+a+" #langs_list").val()}if($(".LangManagement #mods_list").val()!=undefined){b+="&mod="+$(".LangManagement "+a+" #mods_list").val()}if(document.showDiff==true){b+="&sd=1"}if(typeof d!="undefined"){b+="&tpl="+d}$.get("index.php?module=LangManagement&parent=Settings&view=Edit"+b,function(e){jQuery(a).html(e);Settings_Index_Js.initEditLang(d,a);c.progressIndicator({mode:"hide"})})},initEditLang:function(b,a){var c=this;element=$(".LangManagement .layoutContent .active #langs_list");app.changeSelectElementView(element,"selectize",{plugins:["remove_button"]}).on("change",function(d){d=jQuery(this).closest(".active");Settings_Index_Js.LoadEditLang(d)});c.registerHoverCkEditor();c.registerHelpInfo();app.changeSelectElementView($(".LangManagement .active #helpInfoView"),"selectize",{plugins:["remove_button"]}).on("change",function(d){Settings_Index_Js.saveView(d,a)});app.changeSelectElementView($(".LangManagement .layoutContent .active #mods_list"),"select2").on("change",function(d){d=jQuery(this).closest(".active");Settings_Index_Js.LoadEditLang(d)});if(b!="editHelpIcon"){$("#edit_lang .translation").change(function(d){Settings_Index_Js.changeTranslation(d,a)});$("#edit_lang .add_translation").click(Settings_Index_Js.ShowTranslationMondal);$("#edit_lang .delete_translation").click(function(d){Settings_Index_Js.deleteTranslation(d,a)})}$(".LangManagement "+a+" .show_differences").click(Settings_Index_Js.ShowDifferences);$.extend($.fn.dataTable.defaults,{searching:true,ordering:false,bFilter:false,bLengthChange:false,bPaginate:false,bInfo:false,pageLength:-1,language:{sZeroRecords:app.vtranslate("No matching records found"),sSearch:app.vtranslate("Search"),sEmptyTable:app.vtranslate("No data available in table"),}});$(""+a+" .listViewEntriesTable").dataTable()},registerHoverCkEditor:function(){var a=this;jQuery("tr td button.editButton").on("click",function(b){elementTd=jQuery(this).closest("td");a.registerEventForCkEditor(this);a.addClickOutSideEvent(elementTd)})},addClickOutSideEvent:function(a){var b=this;a.one("clickoutside",function(){b.destroyEventForCkEditor(a)})},registerHelpInfo:function(){var a=jQuery(".LangManagement");a.find(".HelpInfoPopover").popover({trigger:"hover",html:"true",})},registerEventForCkEditor:function(f){var d=this;var c=jQuery(f);var b=c.closest("td");var a=b.find("textarea.ckEditorSource");c.addClass("hide");a.removeClass("hide");d.loadCkEditorElement(a)},destroyEventForCkEditor:function(c){var d=this;var a=c.find("textarea.ckEditorSource");var b=a.attr("id");if(typeof b!="undefined"&&a.css("display")=="none"){ckeditor=CKEDITOR.instances[b];var e=ckeditor.getData();if(a.val()!=e){a.val(e);if(e){Settings_Index_Js.changeTranslation(a,"#editHelpIcon");c.find(".HelpInfoPopover").attr("data-content",e)}else{Settings_Index_Js.deleteTranslation(a,"#editHelpIcon");a.addClass("empty_value");c.find(".HelpInfoPopover").attr("data-content","")}}ckeditor.destroy();a.addClass("hide");c.find("button.editButton").removeClass("hide")}},loadCkEditorElement:function(d){var b=this;var a={};if(d.css("display")!="none"){a={disableNativeSpellChecker:true,scayt_autoStartup:false,removePlugins:"scayt",height:"5em",toolbar:null,toolbarGroups:[{name:"document",groups:["mode","document","doctools"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"clipboard",groups:["clipboard","undo"]}]};var c=new Vtiger_CkEditor_Js();c.loadCkEditor(d,a)}},saveView:function(g,b){var f=$(g.currentTarget);if(typeof g.currentTarget=="undefined"){f=jQuery(g)}var c=f.closest("tr");var d=$.progressIndicator({message:app.vtranslate("LBL_Loader"),position:b,blockInfo:{enabled:true}});var a=Settings_Index_Js.registerSaveEvent("saveView",{fieldid:f.data("fieldid"),mod:$(".LangManagement #mods_list").data("target")?$(".LangManagement #mods_list").data("target"):$(".LangManagement #mods_list").val(),value:f.val(),});d.progressIndicator({mode:"hide"})},ShowDifferences:function(b){var a=$(b.currentTarget);if($(this).is(":checked")){document.showDiff=true}else{document.showDiff=false}b=$(this).closest(".active");Settings_Index_Js.LoadEditLang(b)},changeTranslation:function(g,a,d){var f=$(g.currentTarget);if(typeof g.currentTarget=="undefined"){f=jQuery(g)}var b=f.closest("tr");var c=$.progressIndicator({message:app.vtranslate("LBL_Loader"),position:a,blockInfo:{enabled:true}});if(d==undefined){d=jQuery(".LangManagement "+a+" #mods_list").data("target")?jQuery(".LangManagement "+a+" #mods_list").data("target"):jQuery(".LangManagement "+a+" #mods_list").val()}Settings_Index_Js.registerSaveEvent("saveTranslation",{lang:f.data("lang"),mod:d,type:f.data("type"),langkey:b.data("langkey"),val:f.val(),is_new:f.hasClass("empty_value"),});f.removeClass("empty_value");c.progressIndicator({mode:"hide"})},deleteTranslation:function(f,a){var d=$(f.currentTarget);if(typeof f.currentTarget=="undefined"){d=f}var b=d.closest("tr");var c=$.progressIndicator({message:app.vtranslate("LBL_Loader"),position:a,blockInfo:{enabled:true}});Settings_Index_Js.registerSaveEvent("deleteTranslation",{lang:$(".LangManagement #langs_list").val(),mod:$(".LangManagement "+a+" #mods_list").data("target")?$(".LangManagement "+a+" #mods_list").data("target"):$(".LangManagement "+a+" #mods_list").val(),langkey:b.data("langkey"),});c.progressIndicator({mode:"hide"});f=d.closest(".active");Settings_Index_Js.LoadEditLang(f)},initEvant:function(b){b.find("input[type=checkbox]").change(Settings_Index_Js.CheckboxChange);var a={title:app.vtranslate("LBL_AreYouSure"),trigger:"manual",placement:"left",html:"true",content:'<div class="popover_block"><button class="btn btn-danger deleteItem marginLeft10">'+app.vtranslate("LBL_YES")+'</button>   <button class="btn btn-warning pull-right cancel">'+app.vtranslate("Cancel")+"</button></div>"};var c={title:app.vtranslate("JS_ARE_YOU_SURE_TO_SET_AS_DEFAULT"),trigger:"manual",placement:"left",html:"true",content:'<div class="popover_block"><button class="btn btn-danger setDefaultItem">'+app.vtranslate("LBL_YES")+'</button>   <button class="btn btn-warning pull-right cancel">'+app.vtranslate("Cancel")+"</button></div>"};b.find("#deleteItemC").click(function(d){$(d.currentTarget).popover(a).popover("show");$(".popover_block .deleteItem").click(function(){Settings_Index_Js.DeleteLang(b,d);$(d.currentTarget).popover("hide")});$(".popover_block .cancel").click(function(){$(d.currentTarget).popover("hide")})});b.find("#setAsDefault").click(function(d){$(d.currentTarget).popover(c).popover("show");$(".popover_block .setDefaultItem").click(function(){$(d.currentTarget).popover("hide");Settings_Index_Js.setAsDefaultLang(b,d)});$(".popover_block .cancel").click(function(){$(d.currentTarget).popover("hide")})})},CheckboxChange:function(c){var b=$(c.currentTarget);var a=b.closest("tr");Settings_Index_Js.registerSaveEvent("save",{type:"Checkbox",name:b.data("name"),prefix:a.data("prefix"),val:b.is(":checked")})},ShowLangMondal:function(c){var b=$(c.currentTarget);var a=$(".AddNewLangMondal").clone(true,true);app.showModalWindow($(a));$(a).css("z-index","9999999")},ShowTranslationMondal:function(d){var f=$(".LangManagement #langs_list").val();var a="";var b=$(".AddNewTranslationMondal").clone(true,true);b.find('input[name="langs"]').val(JSON.stringify(f));$.each(f,function(e){a+='<div class="form-group"><label class="col-md-4 control-label">'+f[e]+':</label><div class="col-md-8"><input name="'+f[e]+'" class="form-control" type="text" /></div></div>'});b.find(".add_translation_block").html(a);var c=$(d.currentTarget);app.showModalWindow($(b));$(b).css("z-index","9999999")},AddLangMondal:function(f){var d=$(f.currentTarget);var b=d.closest(".modalContainer");var a=Settings_Index_Js.registerSaveEvent("add",{type:"Add",label:b.find("input[name='label']").val(),name:b.find("input[name='name']").val(),prefix:b.find("input[name='prefix']").val()});if(a.resp){$("#lang_list table tbody").append('<tr data-prefix="'+a.params.prefix+'"><td>'+a.params.label+"</td><td>"+a.params.name+"</td><td>"+a.params.prefix+'</td><td><a href="index.php?module=LangManagement&parent=Settings&action=Export&lang='+a.params.prefix+'" class="btn btn-primary btn-xs marginLeft10">'+app.vtranslate("JS_EXPORT")+'</a> <button class="btn btn-success btn-xs marginLeft10" data-toggle="confirmation" id="setAsDefault">'+app.vtranslate("JS_DEFAULT")+'</button> <button class="btn btn-danger btn-xs" data-toggle="confirmation" data-original-title="" id="deleteItemC">'+app.vtranslate("Delete")+"</button></td></tr>");var c=$("#lang_list tr[data-prefix="+a.params.prefix+"]");Settings_Index_Js.initEvant(c);b.find(".AddNewLangMondal").modal("hide");$(".AddNewLangMondal input[name='label']").val("");$(".AddNewLangMondal input[name='name']").val("");$(".AddNewLangMondal input[name='prefix']").val("")}},AddTranslationMondal:function(d){var c=$(d.currentTarget);var b=c.closest(".modalContainer");var a=Settings_Index_Js.registerSaveEvent("addTranslation",{mod:$(".LangManagement #mods_list").val(),form_data:b.find(".AddTranslationForm").serializeFormData()});if(a.resp){b.find(".AddNewTranslationMondal").modal("hide")}Settings_Index_Js.LoadEditLang(jQuery("#edit_lang"));d.preventDefault()},DeleteLang:function(a,b){Settings_Index_Js.registerSaveEvent("delete",{prefix:a.data("prefix")});a.hide()},setAsDefaultLang:function(c,f){var b=Settings_Index_Js.registerSaveEvent("setAsDefault",{prefix:c.data("prefix")});$(f.currentTarget).closest("td").find("#deleteItemC").remove();$(f.currentTarget).remove();var d=b.result.prefixOld;var a=c.closest("tbody");OldTrDefaultLang=a.find('tr[data-prefix="'+d+'"]');OldTrDefaultLang.find("td:last").prepend('<button class="btn btn-danger marginLeftZero" data-toggle="confirmation" data-original-title="" id="deleteItemC">'+app.vtranslate("Delete")+'</button> <button class="btn btn-primary marginLeftZero" data-toggle="confirmation" id="setAsDefault">'+app.vtranslate("JS_DEFAULT")+"</button>");Settings_Index_Js.initEvant(OldTrDefaultLang)},registerSaveEvent:function(e,b){var a="";var d="";var c={};c.data={module:app.getModuleName(),parent:app.getParentModuleName(),action:"SaveAjax",mode:e,params:b};c.async=false;c.dataType="json";AppConnector.request(c).done(function(f){a=f.result;var g={text:a.message,animation:"show"};if(a.success==true){g.type="info"}Vtiger_Helper_Js.showPnotify(g);d=a.success},function(g,f){});return{resp:d,params:c.data.params,result:a}},registerStats:function(){var a=this;jQuery(".showStats").on("click",function(){var c={};var b=jQuery('[name="langs"]').val();c.data={module:app.getModuleName(),parent:app.getParentModuleName(),action:"GetChart",langBase:jQuery('[name="langs_basic"]').val(),langs:jQuery.isArray(b)?b.join(","):b};AppConnector.request(c).then(function(e){var d=e.result;if(d.success&&d.data.length!==0){a.showStats(d.data,d.modules)}},function(e,d){})})},showStats:function(f,c){var n=this;var h='<div class="col-md-8"><div class="panel panel-default"><div class="panel-body">';var m=0;var b=[];for(var g in c){for(var d in c[g]){if(f[d].length==1){continue}var j=f[d][0];m+=j;delete f[d][0];h+='<div class="row moduleRow" data-module="'+d+'"><label class="col-md-3 form-control-static control-label marginTop2">'+c[g][d]+': </label><div class="form-control-static col-md-9">';for(var a in f[d]){if(typeof b[a]=="undefined"){b[a]=0}b[a]+=f[d][a].length;var l=f[d][a].length*100/j;h+='<button class="btn btn-xs btn-primary" data-lang="'+a+'"> '+jQuery('select option[value="'+a+'"]').text()+" - "+l.toFixed(2)+"% </button>&nbsp;"}h+="</div></div>"}}h+="</div></div></div>";this.getDataCharts(b,m);var e=jQuery(".statsData").html(h);app.showScrollBar(e.find(".panel-body"),{height:"400px",railVisible:true,});n.registerStatsEvent()},registerStatsEvent:function(){var a=this;jQuery(".statsData .btn").on("click",function(f){var c=$.progressIndicator({position:"html",blockInfo:{enabled:true}});var d=jQuery(f.currentTarget);var g=d.closest(".moduleRow");var b="index.php?module="+app.getModuleName()+"&parent="+app.getParentModuleName()+"&view=GetLabels&langBase="+jQuery('[name="langs_basic"]').val()+"&lang="+d.data("lang")+"&sourceModule="+g.data("module");app.showModalWindow(null,b,function(e){c.progressIndicator({mode:"hide"});e.find("button:not(.close)").on("click",function(j){var i=jQuery(j.currentTarget);var h=i.closest("tr").find("input");a.changeTranslation(h,"html",h.data("mod"))})})})},getDataCharts:function(h,b){var c=1;var g=[];g.chart={};var f=[];g.ticks=[];g.colors=["#d18b2c"];for(var d in h){var a=h[d]*100/b;var e=jQuery('select option[value="'+d+'"]').text();f.push([c,a.toFixed(2)]);g.ticks.push([c,e]);++c}if(f.length>0){g.chart.data=f;g=jQuery.extend({},g);g.valueLabels={show:true,showAsHtml:true,align:"center",valign:"middle"};jQuery(".widgetData").val(JSON.stringify(g));this.showCharts()}},showCharts:function(){var a=Vtiger_Widget_Js.getInstance(jQuery(".chartBlock"),"Bar");a.init(jQuery(".chartBlock"));a.loadChart()},registerEvents:function(){Settings_Index_Js.initEvants();this.registerStats()}};$(document).ready(function(){document.showDiff=false;Settings_Index_Js.registerEvents()});