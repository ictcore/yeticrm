
Settings_Vtiger_Edit_Js("Settings_Workflows_Edit_Js",{instance:{}},{currentInstance:false,workFlowsContainer:false,init:function(){this.initiate()},getContainer:function(){return this.workFlowsContainer},setContainer:function(a){this.workFlowsContainer=a;return this},getInstance:function(b){if(b in Settings_Workflows_Edit_Js.instance){return Settings_Workflows_Edit_Js.instance[b]}else{var a="Settings_Workflows_Edit"+b+"_Js";Settings_Workflows_Edit_Js.instance[b]=new window[a]();return Settings_Workflows_Edit_Js.instance[b]}},getStepValue:function(){var a=this.currentInstance.getContainer();return jQuery(".step",a).val()},initiate:function(a){if(typeof a=="undefined"){a=jQuery(".workFlowContents")}if(a.is(".workFlowContents")){this.setContainer(a)}else{this.setContainer(jQuery(".workFlowContents",a))}this.initiateStep("1");this.currentInstance.registerEvents()},initiateStep:function(a){var b="step"+a;this.activateHeader(b);var c=this.getInstance(a);this.currentInstance=c},activateHeader:function(b){var a=jQuery(".crumbs ");a.find(".active").removeClass("active");jQuery("#"+b,a).addClass("active")},registerFormSubmitEvent:function(b){var a=this;if(jQuery.isFunction(a.currentInstance.submit)){b.on("submit",function(f){var c=jQuery(f.currentTarget);var d=true;if(jQuery.isFunction(a.currentInstance.isFormValidate)){var d=a.currentInstance.isFormValidate()}if(c.validationEngine("validate")&&d){a.currentInstance.submit().then(function(i){a.getContainer().append(i);var h=a.getStepValue();var g=parseInt(h)+1;a.initiateStep(g);a.currentInstance.initialize();var e=a.currentInstance.getContainer();a.registerFormSubmitEvent(e);a.currentInstance.registerEvents()})}f.preventDefault()})}},back:function(){var e=this.getStepValue();var c=parseInt(e)-1;this.currentInstance.initialize();var b=this.currentInstance.getContainer();var a=jQuery('[name="record"]',b);var f=a.val();b.remove();this.initiateStep(c);var d=this.currentInstance.getContainer();d.show();jQuery('[name="record"]',d).val(f);var g=jQuery("#moduleName",d);if(g.length>0&&f!=""){g.attr("disabled","disabled").trigger("chosen:updated")}},getPopUp:function(a){var b=this;if(typeof a=="undefined"){a=b.getContainer()}a.on("click",".getPopupUi",function(j){var g=jQuery(j.currentTarget);var d=g.val();var q=g.closest(".fieldUiHolder");var h=q.find('[name="valuetype"]').val();if(h==""){h="rawtext"}var m=g.closest(".conditionsContainer");var c=g.closest(".conditionRow");var l=m.find(".popupUi").clone(true,true).removeClass("popupUi").addClass("clonedPopupUi");l.find("select").addClass("chzn-select");l.find(".fieldValue").val(d);if(g.hasClass("date")){l.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");var p=g.data("date-format");if(h=="rawtext"){var o=g.val()}else{o=""}var k='<input type="text" class="dateField fieldValue col-md-4" value="'+o+'" data-date-format="'+p+'" data-input="true" >';l.find(".fieldValueContainer").prepend(k)}else{if(g.hasClass("time")){l.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");if(h=="rawtext"){var o=g.val()}else{o=""}var n='<input type="text" class="timepicker-default fieldValue col-md-4 form-control" value="'+o+'" data-input="true" >';l.find(".fieldValueContainer").prepend(n)}else{if(g.hasClass("boolean")){l.find(".textType").find('option[value="rawtext"]').attr("data-ui","input");if(h=="rawtext"){var o=g.val()}else{o=""}var i='<input type="checkbox" class="fieldValue col-md-4" value="'+o+'" data-input="true" >';l.find(".fieldValueContainer").prepend(i);var d=l.find(".fieldValueContainer input").val();if(o=="true:boolean"||o==""){l.find(".fieldValueContainer input").attr("checked","checked")}else{l.find(".fieldValueContainer input").removeAttr("checked")}}}}var f=function(r){r.find(".clonedPopupUi").removeClass("hide");var s=c.find('[name="modulename"]');if(s.length>0){var e=s.val();r.find(".useFieldElement").addClass("hide");r.find('[name="'+e+'"]').removeClass("hide")}app.changeSelectElementView(r);app.registerEventForDatePickerFields(r);app.registerEventForClockPicker(r);b.postShowModalAction(r,h);b.registerChangeFieldEvent(r);b.registerSelectOptionEvent(r);b.registerPopUpSaveEvent(r,q);b.registerRemoveModalEvent(r);r.find(".fieldValue").filter(":visible").trigger("focus");r.find('[data-close-modal="modal"]').off("click").on("click",function(){jQuery(this).closest(".modal").removeClass("in").css("display","none")})};m.find(".clonedPopUp").html(l);jQuery(".clonedPopupUi").on("shown.bs.modal",function(){if(typeof f=="function"){f(jQuery(".clonedPopupUi",m))}});jQuery(".clonedPopUp",m).find(".clonedPopupUi").modal()})},registerRemoveModalEvent:function(a){a.on("click",".closeModal",function(b){a.modal("hide")})},registerPopUpSaveEvent:function(b,a){jQuery('[name="saveButton"]',b).on("click",function(g){var h=jQuery(".textType",b).val();a.find('[name="valuetype"]').val(h);var d=a.find(".getPopupUi");if(h!="rawtext"){d.removeAttr("data-validation-engine");d.removeClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]")}else{d.addClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]");d.attr("data-validation-engine","validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]")}var c=b.find(".fieldValue").filter(":visible").attr("type");var f=b.find(".fieldValue").filter(":visible").val();if(c=="checkbox"){if(b.find(".fieldValue").filter(":visible").is(":checked")){f="true:boolean"}else{f="false:boolean"}}d.val(f);d.validationEngine("hide");b.remove()})},registerSelectOptionEvent:function(a){jQuery(".useField,.useFunction",a).on("change",function(f){var c=jQuery(f.currentTarget);var d=c.val();var b=a.find(".fieldValue").filter(":visible").val();if(c.hasClass("useField")){if(b!=""){var g=b+" "+d}else{g=d}}else{g=b+d}a.find(".fieldValue").val(g);c.val("").trigger("chosen:updated")})},registerChangeFieldEvent:function(a){jQuery(".textType",a).on("change",function(f){var g=jQuery(f.currentTarget).val();var c=jQuery(".useFieldContainer",a);var d=jQuery(".useFunctionContainer",a);var b=jQuery(f.currentTarget).find("option:selected").data("ui");jQuery(".fieldValue",a).hide();jQuery("[data-"+b+"]",a).show();if(g=="fieldname"){c.removeClass("hide");d.addClass("hide")}else{if(g=="expression"){c.removeClass("hide");d.removeClass("hide")}else{c.addClass("hide");d.addClass("hide")}}jQuery(".helpmessagebox",a).addClass("hide");jQuery("#"+g+"_help",a).removeClass("hide");a.find(".fieldValue").val("")})},postShowModalAction:function(b,c){if(c=="fieldname"){jQuery(".useFieldContainer",b).removeClass("hide");jQuery(".textType",b).val(c).trigger("chosen:updated")}else{if(c=="expression"){jQuery(".useFieldContainer",b).removeClass("hide");jQuery(".useFunctionContainer",b).removeClass("hide");jQuery(".textType",b).val(c).trigger("chosen:updated")}}jQuery("#"+c+"_help",b).removeClass("hide");var a=jQuery(".textType",b).find("option:selected").data("ui");jQuery(".fieldValue",b).hide();jQuery("[data-"+a+"]",b).show()},registerBackStepClickEvent:function(){var b=this;var a=this.getContainer();a.on("click",".backStep",function(c){b.back()})},registerEvents:function(){var a=this.currentInstance.getContainer();this.registerFormSubmitEvent(a);this.registerBackStepClickEvent()}});