jQuery.Class("Settings_RecordAllocation_Index_Js",{},{container:false,registerDataTables:function(a){var b=this;$.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate("JS_S_LENGTH_MENU"),sZeroRecords:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfo:app.vtranslate("JS_S_INFO"),sInfoEmpty:app.vtranslate("JS_S_INFO_EMPTY"),sSearch:app.vtranslate("JS_SEARCH"),sEmptyTable:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfoFiltered:app.vtranslate("JS_S_INFO_FILTERED"),sLoadingRecords:app.vtranslate("JS_LOADING_OF_RECORDS"),sProcessing:app.vtranslate("JS_LOADING_OF_RECORDS"),oAria:{sSortAscending:app.vtranslate("JS_S_SORT_ASCENDING"),sSortDescending:app.vtranslate("JS_S_SORT_DESCENDING")}}});if(a==undefined){a=b.getContainer()}a.find(".dataTable").dataTable({scrollY:200,deferRender:true,scroller:true,paging:false,info:false})},registerDragDropEvent:function(b){var d=this;if(b==undefined){return}var a=b.closest(".panel");var c=a.data("index");b.find(".dragDrop"+c).draggable({appendTo:"body",helper:"clone",start:function(h,g){var f=$(g.helper.context).width();$(g.helper).css("width",f).addClass("dataTableDragDrop bg-primary")},zIndex:9999999999});b.find(".dataTables_scrollBody .dataTable").droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",accept:".dragDrop"+c,drop:function(g,h){var f=$(h.draggable).closest(".dataTable");var e=$(this);if(f.data("mode")!=e.data("mode")){f.DataTable().row(h.draggable).remove().draw();e.DataTable().row.add(h.draggable[0]).draw();var e=e.data("mode")=="active"?e:f;d.save(e.closest(".panel"))}}})},save:function(b){var c={module:b.data("modulename"),userid:b.find("select.baseUser").val(),type:app.getMainParams("fieldType")};var a=[];var d=b.find(".dataTables_scrollBody:first tbody tr");d.each(function(f){var h=jQuery(this).data("id");var g=jQuery(this).data("type");if(h&&g){if(!a[g]){a[g]=[]}a[g].push(h)}});c.ids=jQuery.extend({},a);app.saveAjax("save",jQuery.extend({},c))},registerModalButton:function(){var b=this;var a=this.getContainer();a.find("button.addPanel").on("click",function(){var d=a.find("#myModal").clone(true,true);var e=b.getModules();d.find("select option").each(function(){if(jQuery.inArray(jQuery(this).val(),e)!=-1){jQuery(this).remove()}});var c=function(h){var f=h.find("select");app.showSelect2ElementView(f);var g=h.find("form");g.submit(function(k){var j=jQuery(k.currentTarget);var i=j.find("#modulesList");if(i.length&&i.val()){b.addPanel(i.val())}k.preventDefault()})};app.showModalWindow(d,function(f){if(typeof c=="function"){c(f)}})})},getModules:function(){var b=this;var a=[];this.getContainer().find(".panel").each(function(){a.push(jQuery(this).data("modulename"))});return a},addPanel:function(b){var c=this;var a=jQuery.Deferred();var e=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var d=this.getContainer().find(".panel:last");var f={};f.index=d.data("index");f.module=app.getModuleName();f.parent=app.getParentModuleName();f.sourceModule=b;f.view="Index";f.mode="getPanel";f.type=app.getMainParams("fieldType");AppConnector.request(f).then(function(h){var g=c.getContainer().find(".panelsContainer").append(h);app.changeSelectElementView(g.find(".chzn-select"));app.hideModalWindow();e.progressIndicator({mode:"hide"});a.resolve(h)},function(g){e.progressIndicator({mode:"hide"});a.reject(g)});return a.promise()},registerLoadData:function(){var a=this;this.getContainer().on("change","select.baseUser",function(j){var h=jQuery(j.currentTarget);var b=h.closest(".panelItem");var c=b.find(".moduleAllocationData").val();var g=[];if(c&&c!="null"){g=JSON.parse(c)}var d=g[h.val()];var i=b.find(".activePanel");if(i.length){i.remove()}var i=b.find(".clearTables").clone(true,true);if(d!=undefined){var k=i.find(".dataTable .dropContainer:first");var f=i.find(".dataTable .dropContainer:last");f.find("tr").each(function(){var e=jQuery(this).data("type");var l=jQuery(this).data("id");if(jQuery.inArray(l.toString(),d[e])!=-1){k.append(jQuery(this))}})}b.find(".panel-body").removeClass("hide").append(i.removeClass("clearTables hide").addClass("activePanel"));a.registerDataTables(i);a.registerDragDropEvent(i)})},registerHeaderElements:function(){var a=this;this.getContainer().on("click",".removePanel",function(g){var f=jQuery(g.currentTarget);var b=f.closest(".panel");var d={module:b.data("modulename"),type:app.getMainParams("fieldType")};var c=app.vtranslate("JS_ARE_YOU_SURE_YOU_WANT_TO_DELETE_PANEL");Vtiger_Helper_Js.showConfirmationBox({message:c}).then(function(h){app.saveAjax("removePanel",d).then(function(){b.fadeOut(300,function(){$(this).remove()})})},function(e,h){})});this.registerLoadData()},getContainer:function(){if(this.container==false){this.container=jQuery("div.contentsDiv")}return this.container},registerEvents:function(){this.registerModalButton();this.registerHeaderElements()}});