jQuery.Class("Settings_QuickCreateEditor_Js",{},{updatedBlockSequence:{},updatedBlockFieldsList:[],showSaveButton:function(){var b=jQuery("#relatedTabOrder");var a=b.find(".saveRelatedList");if(a.attr("disabled")=="disabled"){a.removeAttr("disabled")}},makeFieldsListSortable:function(){var c=this;var b=jQuery("#quickCreateEditorContainer").find(".contents");var a=b.find(".editFieldsTable");jQuery("#quickCreateEditorContainer .contents .editFieldsTable").each(function(){jQuery(this).find("ul[name=sortable1], ul[name=sortable2]").sortable({containment:"#moduleBlocks",revert:true,tolerance:"pointer",cursor:"move",connectWith:jQuery(this).find(".connectedSortable"),update:function(h,g){var f=g.item;c.showSaveFieldSequenceButton();if(g.sender){var d=g.sender.closest(".editFieldsTable");c.reArrangeBlockFields(d)}}})})},showSaveFieldSequenceButton:function(){var b=this;var a=jQuery("#detailViewLayout");var c=a.find(".saveFieldSequence");b.updatedBlockFieldsList=[];c.removeClass("visibility")},hideSaveFieldSequenceButton:function(){var a=jQuery("#detailViewLayout");var b=a.find(".saveFieldSequence");b.addClass("visibility")},reArrangeBlockFields:function(e){var a=e.find("ul[name=sortable1]");var c=e.find("ul[name=sortable2]");if(a.children().length<c.children().length){var b=c.children(":last");a.append(b)}else{if(a.children().length>c.children().length+1){var d=a.children(":last");c.append(d)}}},createUpdatedBlockFieldsList:function(){var f=this;var a=jQuery("#quickCreateEditorContainer").find(".contents");var i=a.find(".block");var e=i.find("ul[name=sortable1]");var j=[];e.each(function(m,n){var l=jQuery(n);var k=l.find(".editFields").length;j.push(k)});var c=e.find(".editFields");var d=1;c.each(function(m,n){var l=jQuery(n);var k=l.data("fieldId");f.updatedBlockFieldsList.push({fieldid:k,sequence:d});d=d+2;if(m==j[0]-1){d=1}});var b=i.find("ul[name=sortable2]");var g=b.find(".editFields");var h=2;var j=[];b.each(function(m,n){var l=jQuery(n);var k=l.find(".editFields").length;j.push(k)});g.each(function(m,n){var l=jQuery(n);var k=l.data("fieldId");f.updatedBlockFieldsList.push({fieldid:k,sequence:h});h=h+2;if(m==j[0]-1){h=2}})},registerFieldSequenceSaveClick:function(){var b=this;var a=jQuery("#detailViewLayout");a.on("click",".saveFieldSequence",function(){b.hideSaveFieldSequenceButton();b.createUpdatedBlockFieldsList();b.updateFieldSequence()})},updateFieldSequence:function(){var a=this;var b=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var c={};c.module=app.getModuleName();c.parent=app.getParentModuleName();c.action="SaveSequenceNumber";c.mode="move";c.updatedFields=a.updatedBlockFieldsList;AppConnector.request(c).then(function(d){b.progressIndicator({mode:"hide"});var e={};e.text=app.vtranslate("JS_FIELD_SEQUENCE_UPDATED");Settings_Vtiger_Index_Js.showMessage(e)},function(d){b.progressIndicator({mode:"hide"})})},avoidDropDownClick:function(a){a.find(".dropdown-menu").click(function(b){b.stopPropagation()})},addClickOutSideEvent:function(b,a){b.one("clickoutside",a)},registerModulesChangeEvent:function(){var b=this;var a=jQuery("#quickCreateEditorContainer");var c=a.closest(".contentsDiv");app.showSelect2ElementView(a.find('[name="quickCreateEditorModules"]'),{dropdownCss:{"z-index":0}});a.on("change",'[name="quickCreateEditorModules"]',function(g){var f=jQuery(g.currentTarget);var d=f.val();b.getModuleQuickCreateEditor(d).then(function(e){c.html(e);b.registerEvents()})})},getModuleQuickCreateEditor:function(b){var c=this;var a=jQuery.Deferred();var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var e={};e.module=app.getModuleName();e.parent=app.getParentModuleName();e.view="Index";e.sourceModule=b;AppConnector.requestPjax(e).then(function(f){d.progressIndicator({mode:"hide"});a.resolve(f)},function(f){d.progressIndicator({mode:"hide"});a.reject()});return a.promise()},registerEvents:function(){var a=this;a.registerModulesChangeEvent();a.makeFieldsListSortable();a.registerFieldSequenceSaveClick()}});jQuery(document).ready(function(){var a=new Settings_QuickCreateEditor_Js();a.registerEvents()});