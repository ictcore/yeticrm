
jQuery.Class("Settings_Vtiger_Index_Js",{showMessage:function(a){var b={};b.animation="show";b.type="success";b.title=app.vtranslate("JS_MESSAGE");if(typeof a!="undefined"){var b=jQuery.extend(b,a)}Vtiger_Helper_Js.showPnotify(b)},selectIcon:function(){var a=jQuery.Deferred();app.showModalWindow({id:"iconsModal",url:"index.php?module=Vtiger&view=IconsModal&parent=Settings",cb:function(b){app.showSelect2ElementView(b.find("#iconsList"),{templateSelection:function(d){if(!d.id){return(d.text)}var c=$(d.element).data("type");b.find(".iconName").text(d.id);b.find("#iconName").val(d.id);b.find("#iconType").val(c);if(c==="icon"){b.find(".iconExample").html('<span class="'+d.element.value+'" aria-hidden="true"></span>')}else{if(c==="image"){b.find(".iconName").text(d.text);b.find("#iconName").val(d.text);b.find(".iconExample").html('<img width="24px" src="'+d.element.value+'"/>')}}return d.text},templateResult:function(e){if(!e.id){return(e.text)}var d=$(e.element).data("type");var c;if(d==="icon"){c=$('<span class="'+e.element.value+'" aria-hidden="true"> - '+$(e.element).data("class")+"</span>")}else{if(d==="image"){c=$('<img width="24px" src="'+e.element.value+'" title="'+e.text+'" /><span> - '+e.text+"</span>")}}return c},closeOnSelect:true});b.find('[name="saveButton"]').click(function(c){a.resolve({type:b.find("#iconType").val(),name:b.find("#iconName").val(),});app.hideModalWindow(b,"iconsModal")})}});return a.promise()},showWarnings:function(){jQuery('li[data-mode="systemWarnings"] a').click()},showSecurity:function(){jQuery('li[data-mode="security"] a').click()},},{registerDeleteShortCutEvent:function(b){var a=this;if(typeof b=="undefined"){var b=jQuery("div#settingsShortCutsContainer")}b.on("click",".unpin",function(h){var j=jQuery(h.currentTarget);var i=j.closest(".moduleBlock");var c=j.data("id");var g=i.data("actionurl");var d=g+"&pin=false";var f=jQuery.progressIndicator({blockInfo:{enabled:true}});AppConnector.request(d).then(function(l){if(l.result.SUCCESS=="OK"){i.remove();a.registerSettingShortCutAlignmentEvent();var m="#"+c+"_menuItem";var k=jQuery(m);var e=k.data("pinimageurl");k.attr("src",e).data("action","pin");f.progressIndicator({mode:"hide"});var n={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_SUCCESSFULLY_UNPINNED"),animation:"show",type:"info"};a.registerReAlign();Vtiger_Helper_Js.showPnotify(n)}});h.stopPropagation()})},registerPinShortCutEvent:function(b){var c=this;var e=b.data("id");var a="index.php?module=Vtiger&parent=Settings&action=Basic&mode=updateFieldPinnedStatus&pin=true&fieldid="+e;var d=jQuery.progressIndicator({blockInfo:{enabled:true}});AppConnector.request(a).then(function(f){if(f.result.SUCCESS=="OK"){var g={fieldid:e,mode:"getSettingsShortCutBlock",module:"Vtiger",parent:"Settings",view:"IndexAjax"};AppConnector.request(g).then(function(k){var h=jQuery("#settingsShortCutsContainer");var j=jQuery("#settingsShortCutsContainer div.row:last");var i=jQuery("#settingsShortCutsContainer div.row:last").children("div").length;if(i==3){var m=jQuery("#settingsShortCutsContainer").append('<div class="row">'+k)}else{var m=jQuery(k).appendTo(j)}c.registerSettingShortCutAlignmentEvent();d.progressIndicator({mode:"hide"});var l={text:app.vtranslate("JS_SUCCESSFULLY_PINNED")};Settings_Vtiger_Index_Js.showMessage(l)})}})},registerSettingsShortcutClickEvent:function(){jQuery("#settingsShortCutsContainer").on("click",".moduleBlock",function(b){var a=jQuery(b.currentTarget).data("url");window.location.href=a})},registerSettingShortCutAlignmentEvent:function(){jQuery("#settingsShortCutsContainer").find(".moduleBlock").removeClass("marginLeftZero");jQuery("#settingsShortCutsContainer").find(".moduleBlock:nth-child(3n+1)").addClass("marginLeftZero")},registerWidgetsEvents:function(){var a=jQuery("div.widgetContainer");a.on("shown.bs.collapse",function(g){var c=jQuery(g.currentTarget);var f=c.closest(".quickWidget").find(".quickWidgetHeader");var d=f.find(".imageElement");var b=d.data("downimage");d.attr("src",b)});a.on("hidden.bs.collapse",function(g){var c=jQuery(g.currentTarget);var f=c.closest(".quickWidget").find(".quickWidgetHeader");var d=f.find(".imageElement");var b=d.data("rightimage");d.attr("src",b)})},registerAddShortcutDragDropEvent:function(){var b=this;var c=jQuery(".subMenu .menuShortcut a");var a="ui-draggable-menuShortcut bg-primary";c.draggable({containment:"#page",appendTo:"body",helper:"clone",start:function(f,d){$(d.helper).addClass(a)},zIndex:99999});jQuery("#settingsShortCutsContainer").droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",accept:".subMenu .menuShortcut a",drop:function(e,g){var d=g.draggable.attr("href");var f=false;jQuery('#settingsShortCutsContainer [id^="shortcut"]').each(function(){var i=jQuery(this).data("url");if(i==d){f=true;return}});if(f){var h={title:app.vtranslate("JS_MESSAGE"),text:app.vtranslate("JS_SHORTCUT_ALREADY_ADDED"),animation:"show",type:"info"};Vtiger_Helper_Js.showPnotify(h)}else{b.registerPinShortCutEvent(g.draggable.parent());b.registerSettingShortCutAlignmentEvent()}}})},registerReAlign:function(){var a={mode:"realignSettingsShortCutBlock",module:"Vtiger",parent:"Settings",view:"IndexAjax"};AppConnector.request(a).then(function(b){jQuery("#settingsShortCutsContainer").html(b)})},loadCkEditorElement:function(){var a={};var c=jQuery(".ckEditorSource");var b=new Vtiger_CkEditor_Js();b.loadCkEditor(c,a)},registerSaveIssues:function(){var a=jQuery(".addIssuesModal");a.validationEngine(app.validationEngineOptions);var e=jQuery("#titleIssues");var b=CKEDITOR.instances.bodyIssues;var c=this;var d=a.find(".saveIssues");d.click(function(){if(a.validationEngine("validate")){var f=b.document.getBody().getHtml();var g={module:"Github",parent:app.getParentModuleName(),action:"SaveIssuesAjax",title:e.val(),body:f};AppConnector.request(g).then(function(h){app.hideModalWindow();c.reloadContent();if(h.result.success==true){var i={title:app.vtranslate("JS_LBL_PERMISSION"),text:app.vtranslate("JS_ADDED_ISSUE_COMPLETE"),type:"success",animation:"show"};Vtiger_Helper_Js.showMessage(i)}})}});jQuery('[name="confirmRegulations"]').on("click",function(){var f=jQuery(this);if(f.is(":checked")){d.removeAttr("disabled")}else{d.attr("disabled","disabled")}})},reloadContent:function(){jQuery(".massEditTabs li.active").trigger("click")},resisterSaveKeys:function(c){var b=this;var a=c.find(".authModalContent");a.validationEngine(app.validationEngineOptions);a.find(".saveKeys").click(function(){if(a.validationEngine("validate")){var d={module:"Github",parent:app.getParentModuleName(),action:"SaveKeysAjax",username:$('[name="username"]').val(),client_id:$('[name="client_id"]').val(),token:$('[name="token"]').val()};a.progressIndicator({});AppConnector.request(d).then(function(f){a.progressIndicator({mode:"hide"});if(f.result.success==false){var e=a.find(".errorMsg");e.removeClass("hide");e.html(app.vtranslate("JS_ERROR_KEY"))}else{app.hideModalWindow();b.reloadContent();var g={title:app.vtranslate("JS_LBL_PERMISSION"),text:app.vtranslate("JS_AUTHORIZATION_COMPLETE"),type:"success",animation:"show"};Vtiger_Helper_Js.showMessage(g)}},function(e,f){a.progressIndicator({mode:"hide"});app.hideModalWindow()})}})},registerTabEvents:function(){var a=this;jQuery(".massEditTabs li").on("click",function(){a.loadContent(jQuery(this).data("mode"),false,jQuery(this).data("params"))})},registerPagination:function(){var b=jQuery(".pagination .pageNumber");var a=this;b.click(function(){a.loadContent("github",$(this).data("id"))})},registerAuthorizedEvent:function(){var a=this;jQuery(".showModal").on("click",function(){app.showModalWindow(jQuery(".authModal"),function(b){a.resisterSaveKeys(b)})})},registerGithubEvents:function(a){var b=this;b.registerAuthorizedEvent();b.registerPagination();app.showBtnSwitch(a.find(".switchBtn"));a.find(".switchAuthor").on("switchChange.bootstrapSwitch",function(d,c){b.loadContent("github",1)});a.find(".switchState").on("switchChange.bootstrapSwitch",function(d,c){b.loadContent("github",1)});$(".addIssuesBtn").on("click",function(){var c={module:"Github",parent:app.getParentModuleName(),view:"AddIssue"};a.progressIndicator({});AppConnector.request(c).then(function(d){a.progressIndicator({mode:"hide"});app.showModalWindow(d,function(){b.loadCkEditorElement();b.registerSaveIssues()})})})},registerWarningsAlert:function(){var a=jQuery("#systemWarningAletrs");if(a.length){app.showModalWindow(a,function(b){a.find(".warning").first().removeClass("hide");a.find(".warning .btn").click(function(g){var c=$(this);var f=true;if(c.hasClass("ajaxBtn")){if(c.data("params")==undefined){var d=c.closest("form");if(d.hasClass("validateForm")&&!d.validationEngine("validate")){f=false}var h=c.closest("form").serializeArray().reduce(function(i,e){i[e.name]=e.value;return i},{})}else{var h=c.data("params")}if(f){AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:"SystemWarnings",mode:"update",id:c.closest(".warning").data("id"),params:h,}).then(function(e){if(e.result.result){Vtiger_Helper_Js.showMessage({text:e.result.message,type:"success",animation:"show"})}else{Vtiger_Helper_Js.showMessage({text:e.result.message,type:"error",animation:"show"})}})}}if(c.hasClass("cancel")){AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:"SystemWarnings",mode:"cancel"})}if(f){a.find(".warning").first().remove();if(a.find(".warning").length){a.find(".warning").first().removeClass("hide")}else{app.hideModalWindow(b)}}});a.find('.input-group-addon input[type="checkbox"]').click(function(f){var c=$(this);var d=c.closest(".input-group");if(this.checked){d.find('input[type="text"]').attr("disabled",false)}else{d.find('input[type="text"]').attr("disabled",true)}})})}},registerSystemWarningsEvents:function(a){var b=this;b.registerWarningsFolders(a)},registerWarningsFolders:function(b){var d=this;var e=[];var a=b.find("#treeValues").val();if(a){e=JSON.parse(a)}b.find("#jstreeContainer").jstree({core:{data:e,themes:{name:"proton",responsive:true,icons:false},check_callback:true},plugins:["checkbox"]}).bind("loaded.jstree",function(f,g){$(this).jstree("open_all")}).on("changed.jstree",function(g,f){if(f.action!="model"){d.getWarningsList()}});$.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate("JS_S_LENGTH_MENU"),sZeroRecords:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfo:app.vtranslate("JS_S_INFO"),sInfoEmpty:app.vtranslate("JS_S_INFO_EMPTY"),sSearch:app.vtranslate("JS_SEARCH"),sEmptyTable:app.vtranslate("JS_NO_RESULTS_FOUND"),sInfoFiltered:app.vtranslate("JS_S_INFO_FILTERED"),sLoadingRecords:app.vtranslate("JS_LOADING_OF_RECORDS"),sProcessing:app.vtranslate("JS_LOADING_OF_RECORDS"),oPaginate:{sFirst:app.vtranslate("JS_S_FIRST"),sPrevious:app.vtranslate("JS_S_PREVIOUS"),sNext:app.vtranslate("JS_S_NEXT"),sLast:app.vtranslate("JS_S_LAST")},oAria:{sSortAscending:app.vtranslate("JS_S_SORT_ASCENDING"),sSortDescending:app.vtranslate("JS_S_SORT_DESCENDING")}}});var c=app.showBtnSwitch(b.find(".switchBtn"));c.on("switchChange.bootstrapSwitch",function(g,f){d.getWarningsList()})},getWarningsList:function(){var d=this;var c=d.getSelectedFolders();var a=$("#warningsContent");var b=jQuery.progressIndicator({message:app.vtranslate("JS_LOADING_OF_RECORDS"),blockInfo:{enabled:true}});var e=$(".warningsIndexPage input.switchBtn").bootstrapSwitch("state");AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),view:"Index",mode:"getWarningsList",active:e,folder:c}).then(function(f){a.html(f);d.registerWarningsList(a);b.progressIndicator({mode:"hide"})},function(f){b.progressIndicator({mode:"hide"})})},registerWarningsList:function(a){var b=this;a.find("table").dataTable({order:[[2,"desc"]]});app.showPopoverElementView(a.find(".popoverTooltip"));a.find(".showDescription").click(function(d){var c=$(this).closest("td").find(".showDescriptionContent").html();app.showModalWindow(c)});a.find(".setIgnore").click(function(d){a.find(".popoverTooltip").popover("hide");var c=$(this).closest("tr").data();AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:"SystemWarnings",mode:"update",id:c.id,params:c.status,}).then(function(e){b.getWarningsList(a)},function(e){})})},getSelectedFolders:function(){var a=[];$.each($("#jstreeContainer").jstree("get_selected",true),function(b,c){a.push(c.original.subPath)});return a},loadContent:function(g,h,c){var i=this;var b=jQuery(".indexContainer");var a=b.find(".switchState");var f=b.find(".switchAuthor");var d={mode:g,module:app.getModuleName(),parent:app.getParentModuleName(),view:"Index"};if(h){d.page=h}if(c){d.params=c}if(a.is(":checked")){d.state="closed"}else{d.state="open"}d.author=f.is(":checked");var e=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true,elementToBlock:b}});AppConnector.request(d).then(function(j){e.progressIndicator({mode:"hide"});b.html(j);if(g=="index"){i.registerSettingsShortcutClickEvent();i.registerDeleteShortCutEvent();i.registerWidgetsEvents();i.registerAddShortcutDragDropEvent();i.registerSettingShortCutAlignmentEvent();i.registerWarningsAlert()}else{if(g=="github"){i.registerGithubEvents(b)}else{if(g=="systemWarnings"){i.registerSystemWarningsEvents(b)}else{if(g=="security"){app.showPopoverElementView(b.find(".popoverTooltip"))}}}}})},registerEvents:function(){this.registerTabEvents();this.reloadContent()}});