
var Settings_Roles_Js={newPriviliges:false,initDeleteView:function(){jQuery("#roleDeleteForm").validationEngine(app.validationEngineOptions);jQuery('[data-action="popup"]').on("click",function(d){d.preventDefault();var c=$(d.currentTarget);var b=c.data("field");var a=Vtiger_Popup_Js.getInstance();a.show(c.data("url"));a.retrieveSelectedRecords(function(f){try{f=JSON.parse(f)}catch(g){}if(typeof f=="object"){jQuery('[name="'+b+'_display"]').val(f.label);f=f.value}jQuery('[name="'+b+'"]').val(f)})});jQuery("#clearRole").on("click",function(a){jQuery('[name="transfer_record_display"]').val("")})},initPopupView:function(){jQuery(".roleEle").click(function(b){var a=$(b.currentTarget);jQuery.triggerParentEvent("postSelection",JSON.stringify({value:a.closest("li").data("roleid"),label:a.text()}));self.close()})},initEditView:function(){function b(c,d){var e={module:"Roles",action:"MoveAjax",parent:"Settings",record:c,parent_roleid:d};AppConnector.request(e).then(function(f){if(!f.success){alert(app.vtranslate("JS_FAILED_TO_SAVE"));window.location.reload()}})}jQuery('[rel="tooltip"]').tooltip();function a(c){var d=$(c.currentTarget);app.showModalWindow(null,d.data("url"),function(e){Settings_Roles_Js.initDeleteView()})}jQuery('[data-action="modal"]').click(a);jQuery(".toolbar").hide();jQuery(".toolbar-handle").bind("mouseover",function(d){var c=$(d.currentTarget);jQuery(".toolbar",c).css({display:"inline"})});jQuery(".toolbar-handle").bind("mouseout",function(d){var c=$(d.currentTarget);jQuery(".toolbar",c).hide()});jQuery(".draggable").draggable({containment:".treeView",start:function(f,g){var c=jQuery(g.helper);var e=c.data("refid");var d=jQuery('[data-grouprefid="'+e+'"]');var i=d.data("roleid");if(i=="H5"||i=="H2"){var h={};h.title=app.vtranslate("JS_PERMISSION_DENIED");h.text=app.vtranslate("JS_NO_PERMISSIONS_TO_MOVE");h.type="error";Settings_Vtiger_Index_Js.showMessage(h)}},helper:function(d){var g=$(d.currentTarget);var f=g.closest("li");var e=+(new Date());var c=$("<div/>");c.data("refid",e);c.html(f.clone());f.attr("data-grouprefid",e);return c}});jQuery(".droppable").droppable({hoverClass:"btn-primary",tolerance:"pointer",drop:function(d,h){var e=$(h.helper);var c=e.data("refid");var k=$('[data-grouprefid="'+c+'"]');var j=$(this).closest("div");var i=j.closest("li").data("role");var l=j.closest("li").data("roleid");var f=k.data("role");var g=k.data("roleid");if(i.indexOf(f+"::")==0){return}if(g=="H5"||g=="H2"){return}k.appendTo(j.next("ul"));b(g,l)}})},registerSubmitEvent:function(){var b=this;var a=jQuery("#EditView");a.on("submit",function(h){if(a.data("submit")=="true"&&a.data("performCheck")=="true"){return true}else{var f=jQuery("#profilesList");var d=app.getSelect2ElementFromSelect(f);var c=Vtiger_MultiSelect_Validator_Js.invokeValidation(f);if(c!=true){d.validationEngine("showPrompt",c,"error","bottomLeft",true);h.preventDefault();return}else{d.validationEngine("hide")}if(a.data("jqv").InvalidFields.length<=0){var g=a.serializeFormData();b.checkDuplicateName({rolename:g.rolename,record:g.record}).then(function(e){a.data("submit","true");a.data("performCheck","true");a.submit();jQuery.progressIndicator({blockInfo:{enabled:true}})},function(i,e){var j={};j.text=i.message;j.type="error";Settings_Vtiger_Index_Js.showMessage(j);return false})}else{a.removeData("submit");app.formAlignmentAfterValidation(a)}h.preventDefault()}})},checkDuplicateName:function(b){var a=jQuery.Deferred();var c={module:app.getModuleName(),parent:app.getParentModuleName(),action:"EditAjax",mode:"checkDuplicate",rolename:b.rolename,record:b.record};AppConnector.request(c).then(function(f){var e=f.result;var d=e.success;if(d==true){a.reject(e)}else{a.resolve(e)}},function(d,e){a.reject()});return a.promise()},registerEvents:function(){Settings_Roles_Js.initEditView();Settings_Roles_Js.registerSubmitEvent()}};jQuery(document).ready(function(){Settings_Roles_Js.registerEvents()});