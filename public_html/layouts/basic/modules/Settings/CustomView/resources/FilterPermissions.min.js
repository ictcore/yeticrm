jQuery.Class("Settings_CustomView_FilterPermissions_Js",{},{formElement:false,registerButtonsEvent:function(){var b=this;var a=this.getForm();a.find("button.moveItem").on("click",function(c){b.setDefaultPreferences(c)})},registerDisabledButtons:function(){var a=this.getForm();a.find("button.moveItem").each(function(g,f){var d=jQuery(f);var b=d.data("source");var c=a.find("."+b);if(c.find("option").length&&!c.is(":disabled")){d.prop("disabled",false)}else{d.prop("disabled",true)}})},move:function(d){var c=this.getForm();var f=d.data("source");var i=d.data("target");var g=c.find("."+i);var a=c.find("."+f).find("option:selected");var h={};h.val=a.val();h.label=a.text();h.blockLabel=a.closest("optgroup").attr("label");var b='<option value="'+h.val+'">'+h.label+"</option>";var e=g.find('optgroup[label="'+h.blockLabel+'"]');if(e.length){e.append(b)}else{g.append('<optgroup label="'+h.blockLabel+'">'+b+"</optgroup>")}a.remove();app.showSelect2ElementView(c.find(".select2"))},setDefaultPreferences:function(g){var c=this;var a=this.getForm();var f=jQuery.progressIndicator({message:app.vtranslate("JS_SAVE_LOADER_INFO"),position:this.getForm(),blockInfo:{enabled:true}});var d=jQuery(g.currentTarget);var b=d.data("source");var h={tabid:a.find("#sourceModule").val(),user:a.find("."+b).val(),cvid:a.find("#cvid").val(),action:d.data("action")};app.saveAjax("setFilterPermissions",h,{type:a.find("#type").val()}).then(function(e){if(e.success){if(e.result.success){c.move(d);c.registerDisabledButtons();f.progressIndicator({mode:"hide"});Vtiger_Helper_Js.showPnotify({text:e.result.message,type:"success"})}else{f.progressIndicator({mode:"hide"});Vtiger_Helper_Js.showPnotify({text:e.result.message,type:"error"})}}else{f.progressIndicator({mode:"hide"})}})},getForm:function(){if(this.formElement==false){this.setForm(jQuery("#modalFilterPermissions"))}return this.formElement},setForm:function(a){this.formElement=a;return this},registerEvents:function(){this.registerButtonsEvent();this.registerDisabledButtons()}});jQuery(document).ready(function(b){var a=new Settings_CustomView_FilterPermissions_Js();a.registerEvents()});