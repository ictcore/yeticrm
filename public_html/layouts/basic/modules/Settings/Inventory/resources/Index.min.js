jQuery.Class("Settings_Inventory_Index_Js",{},{duplicateCheckCache:{},edit:function(c,a){var b=jQuery.Deferred();var d=this;var e=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});AppConnector.request(c).then(function(g){var f=function(i){d.duplicateCheckCache={};var h=jQuery("#formInventory");var j=app.validationEngineOptions;j.onValidationComplete=function(l,k){if(k){d.saveDetails(l,a);return k}};h.validationEngine(j);h.submit(function(k){k.preventDefault()})};e.progressIndicator({mode:"hide"});app.showModalWindow(g,function(h){if(typeof f=="function"){f(h)}},{})},function(f){b.reject(f)});return b.promise()},saveDetails:function(c,a){var b=this;var e=c.serializeFormData();var d=c.find('[type="submit"]');d.prop("disabled",true);if(typeof e=="undefined"){e={}}b.validateName(e).then(function(f){if(typeof f=="undefined"){d.prop("disabled",false);return false}var g=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});e.module=app.getModuleName();e.parent=app.getParentModuleName();e.action="SaveAjax";e.view=app.getViewName();AppConnector.request(e).then(function(h){g.progressIndicator({mode:"hide"});app.hideModalWindow();if(typeof h=="string"){h=JSON.parse(h)}if(c.find(".addView").val()=="true"){b.addDetails(h.result)}else{b.updateDetails(h.result,a)}var i={text:app.vtranslate("JS_SAVE_CHANGES")};Settings_Vtiger_Index_Js.showMessage(i)})},function(g,f){d.prop("disabled",false);return false})},addDetails:function(c){var b=jQuery("#inventory");var a=jQuery("#currency");var e="%";if(a.length>0){var a=JSON.parse(a.val());e=a.currency_symbol}var d=jQuery(".inventoryTable",b);var f=jQuery('<tr class="opacity" data-id="'+c.id+'">\n					<td class="textAlignCenter '+c.row_type+'"><label class="name">'+c.name+'</label></td>\n					<td class="textAlignCenter '+c.row_type+'"><span class="value">'+c.value+" "+e+'</span></td>\n					<td class="textAlignCenter '+c.row_type+'"><input class="status" checked type="checkbox">\n						<div class="pull-right actions">\n							<a class="editInventory cursorPointer" data-url="'+c._editurl+'">\n								<span class="glyphicon glyphicon-pencil alignBottom" title="'+app.vtranslate("JS_EDIT")+'"></span>\n							</a>\n							<a class="removeInventory cursorPointer" data-url="{$RECORD->getEditUrl()}"><span title="'+app.vtranslate("JS_DELETE")+'" class="glyphicon glyphicon-trash alignBottom"></span>\n						</div>\n					</td></tr>');d.append(f)},updateDetails:function(d,a){var b=jQuery("#currency");var c="%";if(b.length>0){var b=JSON.parse(b.val());c=b.currency_symbol}a.find(".name").text(d.name);a.find(".value").text(d.value+" "+c);if(d.status=="0"){a.find(".status").prop("checked",true)}else{a.find(".status").prop("checked",false)}},validateName:function(g){var f=this;var b=jQuery.Deferred();var c=g.name;var e=jQuery("#formInventory");var d=e.find('[name="name"]');if(!(c in f.duplicateCheckCache)){f.checkDuplicateName(g).then(function(h){f.duplicateCheckCache[c]=h.success;if(h.success){f.duplicateCheckCache.message=h.message;d.validationEngine("showPrompt",h.message,"error","bottomLeft",true);b.reject(h)}b.resolve(h)},function(i,h){b.reject(i)})}else{if(f.duplicateCheckCache[c]==true){var a=f.duplicateCheckCache.message;d.validationEngine("showPrompt",a,"error","bottomLeft",true);b.reject()}else{b.resolve()}}return b.promise()},checkDuplicateName:function(d){var a=jQuery.Deferred();var c=d.name;var f=d.id;var b=app.getModuleName();var e={module:b,parent:app.getParentModuleName(),action:"SaveAjax",mode:"checkDuplicateName",name:c,id:f,view:app.getViewName()};AppConnector.request(e).then(function(i){if(typeof i=="string"){i=JSON.parse(i)}var h=i.result;var g=h.success;a.resolve(h)},function(g,h){a.reject()});return a.promise()},updateStatus:function(e){var c=jQuery.Deferred();var a=e.closest("tr");var g=a.data("id");var b=e.is(":checked")?0:1;var d=jQuery.progressIndicator({position:"html",blockInfo:{enabled:true}});var f={module:app.getModuleName(),parent:app.getParentModuleName(),action:"SaveAjax",id:g,view:app.getViewName(),status:b};AppConnector.request(f).then(function(h){d.progressIndicator({mode:"hide"});c.resolve(h)},function(h,i){d.progressIndicator({mode:"hide"});c.reject(h)});return c.promise()},removeInventory:function(a){var c=this;var b=app.vtranslate("JS_DELETE_INVENTORY_CONFIRMATION");Vtiger_Helper_Js.showConfirmationBox({message:b}).then(function(d){var f={};f.view=app.getViewName();f.id=a.data("id");app.saveAjax("deleteInventory",f).then(function(e){Settings_Vtiger_Index_Js.showMessage({type:"success",text:e.result.message});a.remove()})},function(d,e){})},registerActions:function(){var b=this;var a=jQuery("#inventory");a.find(".addInventory").click(function(c){var f=jQuery(c.currentTarget);var d=f.data("url");b.edit(d)});a.on("click",".editInventory",function(f){var d=jQuery(f.currentTarget);var c=d.closest("tr");b.edit(d.data("url"),c)});a.on("click",".removeInventory",function(d){var f=jQuery(d.currentTarget);var c=f.closest("tr");b.removeInventory(c)});a.on("click",'.status[type="checkbox"]',function(d){var c=jQuery(d.currentTarget);b.updateStatus(c).then(function(e){var f={};f.text=app.vtranslate("JS_SAVE_CHANGES");Settings_Vtiger_Index_Js.showMessage(f)},function(e){})})},registerEvents:function(){this.registerActions()}});jQuery(document).ready(function(b){var a=new Settings_Inventory_Index_Js();a.registerEvents()});