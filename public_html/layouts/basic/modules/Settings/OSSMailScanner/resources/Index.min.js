
jQuery.Class("Settings_OSSMailScanner_Index_Js",{},{registerColorField:function(a){var b={};b.tags=true;b.templateSelection=function(d){var c=d.id;var e=c.split("@");var f=d.text;if(!e[0]){f=$('<span class="domain">'+d.text+"</span>")}return f};app.showSelect2ElementView(a,b)},registerEditFolders:function(a){a.find(".editFolders").on("click",function(){var b="index.php?module=OSSMailScanner&parent=Settings&view=Folders&record="+$(this).data("user");var c=jQuery.progressIndicator({message:app.vtranslate("LBL_LOADING_LIST_OF_FOLDERS"),position:"html",blockInfo:{enabled:true}});app.showModalWindow("",b,function(d){c.progressIndicator({mode:"hide"});app.showScrollBar(d.find(".modal-body"),{height:app.getScreenHeight(70)+"px"});d.find('[name="saveButton"]').click(function(g){var f={};d.find("select").each(function(){var e=$(this);var i=e.val();if(i==null){i=[]}f[e.attr("name")]=i});var h={module:"OSSMailScanner",parent:"Settings",action:"SaveAjax",mode:"updateFolders",user:d.find(".modal-body").data("user"),folders:f};AppConnector.request(h).then(function(i){var e=i.result;if(e.success){var j={text:e.message,type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(j)}else{var j={text:e.message,animation:"show"};Vtiger_Helper_Js.showPnotify(j)}app.hideModalWindow()})})})})},registerEvents:function(){var b=this;var a=jQuery(".contentsDiv");b.registerColorField($("#exceptions select"));b.registerEditFolders(a);$("#exceptions select").on("select2:select",function(d){var c=d.params.data.id;if(!!b.domainValidateToExceptions(c)||!!b.email_validate(c)){b.saveWidgetConfig(jQuery(this).attr("name"),jQuery(this).val().join(),"exceptions");b.registerColorField(jQuery(this))}else{jQuery(this).find("option[value='"+c+"']").remove();jQuery(this).trigger("change");var f={text:app.vtranslate("JS_mail_error"),type:"error",animation:"show"};Vtiger_Helper_Js.showPnotify(f)}}).on("select2:unselect",function(){b.saveWidgetConfig(jQuery(this).attr("name"),jQuery(this).val(),"exceptions")});$("#status").change(function(){$("#confirm").attr("disabled",!this.checked)});jQuery(".conftabChangeTicketStatus").on("click",function(){if($(this).data("active")=="1"){return false}$(".conftabChangeTicketStatus").data("active",0);$(this).data("active",1);AppConnector.request({async:true,data:{module:"OSSMailScanner",action:"SaveRcConfig",ct:"emailsearch",type:"changeTicketStatus",vale:$(this).val()}}).done(function(c){if(c.success){var d={text:c.result.data,type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(d)}},function(d,c){})});jQuery(".delate_accont").on("click",function(){var d=this;if(window.confirm(app.vtranslate("whether_remove_an_identity"))){var e={};var c=jQuery(this).data("user-id");e.data={module:"OSSMailScanner",action:"AccontRemove",id:c};e.async=true;AppConnector.request(e).done(function(f){var g={text:f.result.data,type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(g);jQuery("#row_account_"+c).hide()},function(g,f){})}});jQuery(".identities_del").on("click",function(){var c=this;if(window.confirm(app.vtranslate("whether_remove_an_identity"))){var d={};d.data={module:"OSSMailScanner",action:"IdentitiesDel",id:jQuery(this).data("id")};d.async=true;AppConnector.request(d).done(function(e){var f={text:app.vtranslate("removed_identity"),type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(f);jQuery(c).parent().parent().remove()},function(f,e){})}});jQuery(".expand-hide").on("click",function(){var c=jQuery(this).data("user-id");var d=jQuery('tr[data-user-id="'+c+'"]');if("none"==d.css("display")){d.show()}else{d.hide()}});$(".alert").alert();jQuery("select[id^='function_list_']").change(function(){b.saveActions(jQuery(this).data("user-id"),jQuery(this).val())});jQuery("select[id^='user_list_']").change(function(){b.saveCRMuser(jQuery(this).data("user"),jQuery(this).val())});jQuery("#email_search").change(function(){b.saveEmailSearchList(jQuery("#email_search").val())});jQuery("#tab_email_view_widget_limit").on("blur",function(){b.saveWidgetConfig("widget_limit",jQuery(this).val(),"email_list")});jQuery("#tab_email_view_open_window").on("change",function(){b.saveWidgetConfig("target",jQuery(this).val(),"email_list")});jQuery('[name="email_to_notify"]').on("blur",function(){var c=jQuery(this).val();if(!!b.email_validate(c)){b.saveWidgetConfig("email",c,"cron")}else{var d={text:app.vtranslate("JS_mail_error"),type:"error",animation:"show"};Vtiger_Helper_Js.showPnotify(d)}});jQuery('[name="time_to_notify"]').on("blur",function(){var c=jQuery(this).val();if(!!b.number_validate(c)){b.saveWidgetConfig("time",jQuery(this).val(),"cron")}else{var d={text:app.vtranslate("JS_time_error"),type:"error",animation:"show"};Vtiger_Helper_Js.showPnotify(d)}})},saveActions:function(a,c){var b={module:"OSSMailScanner",action:"SaveActions",userid:a,vale:c};AppConnector.request(b).then(function(e){var d=e.result;if(d.success){var f={text:d.data,type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(f)}else{var f={text:d.data,animation:"show"};Vtiger_Helper_Js.showPnotify(f)}},function(e,d){})},saveCRMuser:function(a,b){var c={module:"OSSMailScanner",action:"SaveCRMuser",userid:a,value:b};AppConnector.request(c).then(function(e){var d=e.result;if(d.success){var f={text:d.data,type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(f)}else{var f={text:d.data,animation:"show"};Vtiger_Helper_Js.showPnotify(f)}},function(e,d){})},isEmpty:function(a){if(!!a){return a}return""},saveEmailSearchList:function(b){var a={module:"OSSMailScanner",action:"saveEmailSearchList",vale:b};AppConnector.request(a).then(function(d){var c=d.result;if(c.success){var e={text:c.data,type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(e)}else{var e={text:c.data,animation:"show"};Vtiger_Helper_Js.showPnotify(e)}},function(d,c){})},domainValidateToExceptions:function(b){var a=/^@([a-zA-Z0-9.-]+\.)+[a-zA-Z0-9.-]{2,63}$/;return a.test(b)},email_validate:function(b){var a=/^[a-zA-Z0-9._-]+@([a-zA-Z0-9.-]+\.)+[a-zA-Z0-9.-]{2,63}$/;return a.test(b)},number_validate:function(b){var a=!/^\s*$/.test(b)&&!isNaN(b);return a},saveWidgetConfig:function(a,c,b){var d={module:"OSSMailScanner",action:"SaveWidgetConfig",conf_type:b,name:a,value:c};AppConnector.request(d).then(function(f){var e=f.result;if(e.success){var g={text:e.data,type:"info",animation:"show"};Vtiger_Helper_Js.showPnotify(g)}else{var g={text:e.data,animation:"show"};Vtiger_Helper_Js.showPnotify(g)}},function(f,e){})}});