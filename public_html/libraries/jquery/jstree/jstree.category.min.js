
(function(a){if(typeof define==="function"&&define.amd){define("jstree.category",["jquery","jstree"],a)}else{if(typeof exports==="object"){a(require("jquery"),require("jstree"))}else{a(jQuery,jQuery.jstree)}}}(function(c,a,d){if(c.jstree.plugins.category){return}c.jstree.defaults.category={checkClass:" glyphicon-check",uncheckClass:" glyphicon-unchecked"};var b=document.createElement("I");b.className="jstree-category glyphicon";b.setAttribute("role","presentation");c.jstree.plugins.category=function(e,f){this.bind=function(){f.bind.call(this);this._data.category.selected=[];this.element.on("model.jstree",c.proxy(function(o,l){var g=this._model.data,n=g[l.parent],q=l.nodes,k,h;for(k=0,h=q.length;k<h;k++){if(g[q[k]].original.type=="category"){g[q[k]].category=[];g[q[k]].category.checked=(g[q[k]].category&&g[q[k]].category.checked)||(g[q[k]].original&&g[q[k]].original.category&&g[q[k]].original.category.checked);if(g[q[k]].category.checked){this._data.category.selected.push(q[k])}}}},this))};this.redraw_node=function(p,g,m,o){p=f.redraw_node.apply(this,arguments);if(p){var l,h,k=null,n=null;for(l=0,h=p.childNodes.length;l<h;l++){if(p.childNodes[l]&&p.childNodes[l].className&&p.childNodes[l].className.indexOf("jstree-anchor")!==-1){k=p.childNodes[l];break}}if(k&&this._model.data[p.id].category!==d){n=b.cloneNode(false);if(this._model.data[p.id].category.checked){n.className+=e.checkClass}else{n.className+=e.uncheckClass}k.insertBefore(n,k.childNodes[0])}}return p};this.select_node=function(l,n,g,k){if(k.target.className.indexOf("noAction")<0&&this.get_node(l).original.type=="category"){l=this.get_node(l);if(l.category.checked){this.uncheckNode(l,k)}else{this.checkNode(l,k)}return false}else{var m,j,h,i;if(c.isArray(l)){l=l.slice();for(j=0,h=l.length;j<h;j++){this.select_node(l[j],n,g,k)}return true}l=this.get_node(l);if(!l||l.id===c.jstree.root){return false}m=this.get_node(l,true);if(!l.state.selected){l.state.selected=true;this._data.core.selected.push(l.id);if(!g){m=this._open_to(l)}if(m&&m.length){m.attr("aria-selected",true).children(".jstree-anchor").addClass("jstree-clicked")}this.trigger("select_node",{node:l,selected:this._data.core.selected,event:k});if(!n){this.trigger("changed",{action:"select_node",node:l,selected:this._data.core.selected,event:k})}}}};this.deselect_node=function(j,l,i){if(this.get_node(j).original.type=="category"){j=this.get_node(j);if(j.category.checked){this.uncheckNode(j,i)}else{this.checkNode(j,i)}return false}else{var h,g,k;if(c.isArray(j)){j=j.slice();for(h=0,g=j.length;h<g;h++){this.deselect_node(j[h],l,i)}return true}j=this.get_node(j);if(!j||j.id===c.jstree.root){return false}k=this.get_node(j,true);if(j.state.selected){j.state.selected=false;this._data.core.selected=c.vakata.array_remove_item(this._data.core.selected,j.id);if(k.length){k.attr("aria-selected",false).children(".jstree-anchor").removeClass("jstree-clicked")}this.trigger("deselect_node",{node:j,selected:this._data.core.selected,event:i});if(!l){this.trigger("changed",{action:"deselect_node",node:j,selected:this._data.core.selected,event:i})}}}};this.checkNode=function(h,g){if(!h.category.checked){var i=this.get_node(h,true);h.category.checked=true;this._data.category.selected.push(h.id);if(i&&i.length){i.children(".jstree-anchor").find(".jstree-category").addClass(e.checkClass).removeClass(e.uncheckClass);this.trigger("changed",{action:"select_node",node:h,selected:this._data.core.selected,event:g})}}};this.uncheckNode=function(h,g){if(h.category.checked){var i=this.get_node(h,true);h.category.checked=false;this._data.category.selected=c.vakata.array_remove_item(this._data.category.selected,h.id);if(i&&i.length){i.children(".jstree-anchor").find(".jstree-category").removeClass(e.checkClass).addClass(e.uncheckClass);this.trigger("changed",{action:"deselect_node",node:h,selected:this._data.core.selected,event:g})}}};this.getCategory=function(g){var g=typeof g!=="undefined"?true:false;var k,h,l=[];for(k=0,h=this._data.category.selected.length;k<h;k++){if(g){l.push(this._model.data[this._data.category.selected[k]].original)}else{l.push(this._model.data[this._data.category.selected[k]].original.record_id)}}return l}}}));