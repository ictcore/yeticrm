
function SMSTask(j){var b=fn.map;var g=fn.dict;var c=fn.filter;var i=fn.reduceR;var l=fn.parallelExecuter;var h=fn.contains;var m=fn.concat;var k=new VtigerWebservices("webservice.php");function f(p){return function(r,q){if(r){p(q)}else{errorDialog("Failure:"+q)}}}function a(t){var p=t.fields;for(var q=0;q<p.length;q++){var s=p[q];var r=s.type;if(r.name=="owner"){r.name="reference";r.refersTo=["Users"]}}return t}function n(q,r){var p=[];j.each(r,function(t,s){if(h(q,s)){p.push(s)}});return p}function d(r,t){if(document.selection){r.focus();var s=document.selection.createRange();s.text=t;r.focus()}else{if(r.selectionStart||r.selectionStart=="0"){var q=r.selectionStart;var p=r.selectionEnd;var u=r.scrollTop;r.value=r.value.substring(0,q)+t+r.value.substring(p,r.value.length);r.focus();r.selectionStart=q+t.length;r.selectionEnd=q+t.length;r.scrollTop=u}else{r.value+=t;r.focus()}}}function e(r,u,A,v){if(v==null){v=function(){return true}}var B=u[A];var w=B.fields;function D(F){return c(function(H){var G=!h(["autogenerated","reference","owner","multipicklist","password"],H.type.name);var I=v(H);return G&&I},F)}var s=b(function(F){return[F.name,F.label]},D(B.fields));var C=c(function(F){return(F.type["name"]=="reference")},B.fields);var z={};j.each(u,function(G,F){z[G]=g(b(function(H){return[H.name,H.type]},D(F.fields)))});function q(H){var G=H.match(/(\w+) : \((\w+)\) (\w+)/);var F="";var I="";if(G==null){F=moduleName;I=H}else{F=G[2];I=G[3]}return z[F][I]}function E(I){var G=I.name;var F=I.label;function H(J){if(!h(accessibleModulesInfo,J)){return[]}return b(function(K){return["("+G+" : ("+J+") "+K.name+")",F+" : ("+J+") "+K.label]},D(u[J]["fields"]))}return i(m,b(H,I.type["refersTo"]),[])}var p=i(m,b(E,C),[]);var y=g(s.concat(p));var x=j("#"+r);var t=r+"_option";j.each(y,function(G,F){x.append('<option class="'+t+'" value="'+G+'">'+F+"</option>")})}function o(p,q,r){k.describeObject(q,f(function(A){var y=a(A);var v=y.fields;var s=c(function(B){return B.type["name"]=="reference"},v);var x=b(function(B){return B.type["refersTo"]},s);function w(C,B){var D=c(function(E){return !h(C,E)},B);return C.concat(D)}var u=i(w,x,[y.name]);u=n(p,u);function z(E){var D=c(function(G){return G[0]==false},E);if(D.length!=0){var C=D[0];r(false,C[1])}else{var F=b(function(G){return a(G[1])},E);var B=g(b(function(G){return[G.name,G]},F));r(true,B)}}var t=l(z,u.length);j.each(u,function(C,B){t(function(D){k.describeObject(B,D)})})}))}j(document).ready(function(){k.extendSession(f(function(p){k.listTypes(f(function(q){accessibleModulesInfo=q;o(q,moduleName,f(function(r){e("sms_fieldnames",r,moduleName);j("#task-fieldnames-busyicon").hide();j("#sms_fieldnames").show();j("#sms_fieldnames").change(function(){var s=j("#save_content").get(0);var t="$"+j(this).attr("value");d(s,t)});e("task_phonefields",r,moduleName,function(s){return s.type["name"]=="phone"});j("#task-phonefields-busyicon").hide();j("#task_phonefields").show();j("#task_phonefields").change(function(){var s=j(j("#save_recepient").get());var t="$"+j(this).attr("value");s.attr("value",s.attr("value")+","+t)})}))}))}));validator.mandatoryFields.push("sms_recepient")})}SMSTask(jQuery);